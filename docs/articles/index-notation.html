<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Index Notation in ipmr • ipmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Index Notation in ipmr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipmr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ipmr-introduction.html">Introduction to ipmr</a>
    </li>
    <li>
      <a href="../articles/general-ipms.html">General IPMs</a>
    </li>
    <li>
      <a href="../articles/index-notation.html">Index Notation in ipmr</a>
    </li>
    <li>
      <a href="../articles/age_x_size.html">Age X Size IPMs</a>
    </li>
    <li>
      <a href="../articles/density-dependence.html">Density/Frequency Dependent IPMs</a>
    </li>
    <li>
      <a href="../articles/proto-ipms.html">proto_ipm Data Structure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/padrinoDB/ipmr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Index Notation in ipmr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/padrinoDB/ipmr/blob/main/vignettes/index-notation.Rmd" class="external-link"><code>vignettes/index-notation.Rmd</code></a></small>
      <div class="hidden name"><code>index-notation.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette describes how to write formulas using
<code>ipmr</code>’s notation for models derived from parameter sets.
Parameter sets may be derived from mixed models, or fixed effects that
are discrete. The notation is meant to mirror the standard mathematical
notation used to represent the models. The examples here will primarily
use <a href="https://github.com/lme4/lme4/" class="external-link">lme4</a> to illustrate how
to go from vital rate models to functional forms that you can use in
<code>ipmr</code>. You are of course free to use whatever model fitting
software you like, but the number of different possibilities are far too
great to cover in this vignette.</p>
<p>The <code>ipmr</code> notation is meant to make implementing models
more concise, as it allows you to avoid re-typing/copy+pasting the same
kernel formats and just substituting, for example, plot name or
transition year. It works by appending an index suffix to kernels, vital
rates, and parameters that can take multiple values (e.g. <code>P</code>
becomes <code>P_yr</code>). We then add a named list where the names
correspond to the index and the entries correspond to the values it can
take. We pass pass the list to <code>par_set_indices</code>
(i.e. <code>par_set_indices = list(yr = 1:5)</code>), and set
<code>uses_par_sets = TRUE</code>.</p>
<blockquote>
<p>NB: because of the way these indices are handled internally, they
should always appear at the end of the name they modify. For example,
use <code>s_slope_site</code> instead of <code>s_site_slope</code>.
Multiple indices are fine as long as they chained together at the end
(e.g. <code>s_slope_site_year</code>). Models may still work if
formatted with indices in the middle of a name, but they also may not
(often with obscure error messages).</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="quick">Quick start guide<a class="anchor" aria-label="anchor" href="#quick"></a>
</h2>
<p>Some quick translations between mathematical notation, R model
syntax, and <code>ipmr</code> style notation. In the <code>ipmr</code>
column, index suffixes that are appended are highlighted in
<strong>bold</strong>.</p>
<p>Suffix names are not restricted to the examples below, and can be
anything you want them to be.</p>
<div class="section level3">
<h3 id="notation-guide">Notation guide<a class="anchor" aria-label="anchor" href="#notation-guide"></a>
</h3>
<p>The mathematical notation in this vignette will take the following
form:</p>
<p>Coefficients/parameters:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
- intercept,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
- slope,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
- mean,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
standard deviation.</p>
<p>Vital rates: subscripts on the coefficients/parameters. For example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>G</mi></msub><annotation encoding="application/x-tex">\alpha_G</annotation></semantics></math>
for the intercept of a growth model.</p>
<p>Kernels: bivariate kernels are denoted with capital letters (e.g. a
growth kernel
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G(z',z)</annotation></semantics></math>)
and univariate functions are denoted with lower case letters (e.g. a
survival function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s(z)</annotation></semantics></math>).</p>
<p>Indices: superscripts on coefficients. For example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>g</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><annotation encoding="application/x-tex">\beta_g^{site}</annotation></semantics></math>
for a site specific growth slope.</p>
<p>Probability density functions: these are denoted with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mi>p</mi></msub><annotation encoding="application/x-tex">f_p</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mi>p</mi></msub><annotation encoding="application/x-tex">_p</annotation></semantics></math>
is replaced by the vital rate. For example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>G</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><msub><mi>μ</mi><mi>G</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>G</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_G(z',\mu_G, \sigma_G)</annotation></semantics></math>
would denote a probability density function for growth.</p>
<table style="width:150%;" class="table">
<caption>
Math Formula corresponds to the mathematical notation for the model. R
Formula corresponds to how one could write the model using R’s model
formula syntax (think <code>lm</code>, <code>glm</code>,
<code>lmer</code>). ipmr shows an equivalent way to write this model in
kernel formula or vital rate expression. Model Number indicates which
rows are grouped together, as some models have too many terms to cleanly
fit on a line, or have multiple equivalent representations.
</caption>
<thead><tr>
<th style="text-align:left;">
Math Formula
</th>
<th style="text-align:left;">
R Formula
</th>
<th style="text-align:left;">
ipmr
</th>
<th style="text-align:right;">
Model Number
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>μ</mi><mi>G</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mo>=</mo><msub><mi>α</mi><mi>G</mi></msub><mo>+</mo><msubsup><mi>α</mi><mi>G</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mo>*</mo><msub><mi>β</mi><mi>G</mi></msub><mo>*</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">\mu_G^{yr} = \alpha_G + \alpha_G^{yr} * \beta_G * z</annotation></semantics></math>
</td>
<td style="text-align:left;">
<code>size_2 ~ size_1 + (1 | year), family = gaussian()</code>
</td>
<td style="text-align:left;">
mu_g_<strong>yr</strong> = g_int + g_int_<strong>yr</strong> + g_slope *
z
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>f</mi><mi>G</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><msubsup><mi>μ</mi><mi>g</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mo>,</mo><msub><mi>σ</mi><mi>G</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G(z',z) = f_G(z', \mu_g^{yr}, \sigma_G)</annotation></semantics></math>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
g = dnorm(z_2, mu_g_<strong>yr</strong>, sd_g)
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>μ</mi><mi>s</mi><mrow><mi>p</mi><mi>l</mi><mi>o</mi><mi>t</mi><mo>,</mo><mi>y</mi><mi>r</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mi>s</mi></msub><mo>+</mo><msubsup><mi>α</mi><mi>s</mi><mrow><mi>p</mi><mi>l</mi><mi>o</mi><mi>t</mi><mo>,</mo><mi>y</mi><mi>r</mi></mrow></msubsup><mo>+</mo><mi>β</mi><mo>*</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">Logit(\mu_{s}^{plot,yr}) = \alpha_s + \alpha_{s}^{plot,yr} + \beta * z</annotation></semantics></math>
</td>
<td style="text-align:left;">
<code>surv ~ size_1 + (1 | year) + (1 | plot), family = binomial()</code>
</td>
<td style="text-align:left;">
s_<strong>pl</strong>_<strong>yr</strong> = s_int +
s_int_<strong>pl</strong>_<strong>yr</strong> + s_slope * z
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<code>surv ~ size_1 + (1 | year) + (1 | plot), family = binomial()</code>
</td>
<td style="text-align:left;">
s_<strong>pl</strong>_<strong>yr</strong> = s_int +
s_int_<strong>pl</strong> + s_int_<strong>yr</strong> + s_slope * z
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
s = inv_logit(s_<strong>pl</strong>_<strong>yr</strong>)
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>μ</mi><mi>r</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mi>r</mi></msub><mo>+</mo><msubsup><mi>α</mi><mi>r</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mi>r</mi></msub><mo>+</mo><msubsup><mi>β</mi><mi>r</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">log(\mu_{r}^{yr}) = \alpha_{r} + \alpha_r^{yr} + (\beta_r + \beta_r^{yr}) * z</annotation></semantics></math>
</td>
<td style="text-align:left;">
<code>fec ~ size_1 + (size_1 | year), family = poisson()</code>
</td>
<td style="text-align:left;">
r = exp(r_int + r_int_<strong>yr</strong> + (r_slope +
r_slope_<strong>yr</strong>) * z)
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p>Internally, <code>ipmr</code> generates the various levels using
<code>expand.grid</code>. This means that every combination of the
values in <code>par_set_indices</code> must exist in the
<code>data_list</code>, or the model will fail with an error along the
lines of (<code>Error in eval_tidy: object 'x_yz' not found</code>). In
order to exclude levels that do not exist in your data, you can add a
vector to the list in <code>par_set_indices</code> called
<code>drop_levels</code>. This should contain the values you wish to
exclude as a character vector. For example, if data are collected for
<code>sites = c("a", "b", "c")</code>, and
<code>years = c(2005:2008)</code>, but there is no data from site
<code>"a"</code> in 2007, we can use
<code>par_set_indices = list(site = c("a", "b", "c"), year = c(2005:2008), drop_levels = c("a_2007"))</code>.</p>
<p>When picking values to appear in <code>par_set_indices</code>, it is
best to avoid longer words or phrases where words are separated by
underscores
(e.g. <code>treatment = c("h_removal", "c_addition")</code>), as this
may cause problems when values are substituted into expressions.
CamelCase is generally safer in these cases (e.g. use
<code>treatment = c("hRemoval", "cAddition")</code> instead of
<code>treatment = c("h_removal", "c_addition")</code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="sim_di_s_k">Models with a single indexed variable<a class="anchor" aria-label="anchor" href="#sim_di_s_k"></a>
</h2>
<p>These models are pretty common in the IPM literature. Examples
include IPMs where a single site has been sampled over many years, or
sampled many sites across one transition.</p>
<p>This example will use a hypothetical study that spans 5 transitions
and has 6 consecutive censuses. The temporal variation will be denoted
with a index/superscript appended to each term that it modifies
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>x</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><annotation encoding="application/x-tex">x^{yr}</annotation></semantics></math>/<code>x_yr</code>).
To limit complexity, let’s pretend our exploratory analysis and model
selection indicated the best overall models included random year-specifc
intercepts for growth
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>g</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><annotation encoding="application/x-tex">g^{yr}</annotation></semantics></math>)
and survival
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>s</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><annotation encoding="application/x-tex">s^{yr}</annotation></semantics></math>),
but not probability of reproduction
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>p</mi></msub><annotation encoding="application/x-tex">r_p</annotation></semantics></math>),
recruit production
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>r</mi></msub><annotation encoding="application/x-tex">r_r</annotation></semantics></math>),
or the recruit size distribution
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>d</mi></msub><annotation encoding="application/x-tex">r_d</annotation></semantics></math>).
We will work with a simple model to start (i.e. 1 continuous state
variable, no discrete states). This yields the following IPM
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>,</mo><mi>z</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">z,z'</annotation></semantics></math>
represent size/height/weight at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t+1</annotation></semantics></math>,
respectively):</p>
<ol style="list-style-type: decimal">
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mi>L</mi><mi>U</mi></msubsup><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>P</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">n(z', t + 1) = \int_L^U [P^{yr}(z',z) + F(z',z)]n(z,t)dz</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>P</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>s</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msup><mi>g</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P^{yr}(z', z) = s^{yr}(z) * g^{yr}(z',z)</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>r</mi><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>r</mi><mi>r</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>r</mi><mi>d</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F(z',z) = r_p(z) + r_r(z) + r_d(z')</annotation></semantics></math></p></li>
</ol>
<p>Note that only the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>
kernel get the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">yr</annotation></semantics></math>
subscript appended to them - this is the only one that our model
selection process decided had substantial year to year variation. Thus,
we can actually write the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
kernel the exact same way as we would in a simple IPM when we implement
the model in <code>ipmr</code>.</p>
<p>The vital rate models could be written on paper as follows:</p>
<ol start="4" style="list-style-type: decimal">
<li>
<p>Growth</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>μ</mi><mi>G</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>G</mi></msub><mo>+</mo><msubsup><mi>α</mi><mi>G</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>β</mi><mi>G</mi></msub><mo>*</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">\mu_G^{yr}(z) = (\alpha_G + \alpha_G^{yr})+ \beta_G * z</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>G</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>f</mi><mi>G</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><msubsup><mi>μ</mi><mi>G</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>σ</mi><mi>G</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G^{yr}(z',z) = f_G(z', \mu_G^{yr}(z), \sigma_G)</annotation></semantics></math></p></li>
</ul>
</li>
<li>
<p>Survival</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>s</mi><mrow><mi>y</mi><mi>r</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>s</mi></msub><mo>+</mo><msubsup><mi>α</mi><mi>s</mi><mrow><mi>y</mi><mi>r</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>β</mi><mi>s</mi></msub><mo>*</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">Logit(s^{yr}(z)) = (\alpha_s + \alpha_s^{yr}) + \beta_s * z</annotation></semantics></math></li>
</ul>
</li>
<li>
<p>Probability of reproducing</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><msub><mi>r</mi><mi>p</mi></msub></msub><mo>+</mo><msub><mi>β</mi><msub><mi>r</mi><mi>p</mi></msub></msub><mo>*</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">Logit(r_p(z)) = \alpha_{r_p} + \beta_{r_p} * z</annotation></semantics></math></li>
</ul>
</li>
<li>
<p>Recruit production</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mi>r</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><msub><mi>r</mi><mi>r</mi></msub></msub><mo>+</mo><msub><mi>β</mi><msub><mi>r</mi><mi>r</mi></msub></msub><mo>*</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">log(r_r(z)) = \alpha_{r_r} + \beta_{r_r} * z</annotation></semantics></math></li>
</ul>
</li>
<li>
<p>Recruit size distribution</p>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>d</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>f</mi><msub><mi>r</mi><mi>d</mi></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><msub><mi>μ</mi><msub><mi>r</mi><mi>d</mi></msub></msub><mo>,</mo><msub><mi>σ</mi><msub><mi>r</mi><mi>d</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">r_d(z') = f_{r_d}(z', \mu_{r_d}, \sigma_{r_d})</annotation></semantics></math></li>
</ul>
</li>
</ol>
<p>and modeled in R as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://padrinoDB.github.io/ipmr/" class="external-link">ipmr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">grow_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">size_2</span> <span class="op">~</span> <span class="va">size_1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">year</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">grow_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surv_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">glmer</a></span><span class="op">(</span><span class="va">surv</span> <span class="op">~</span> <span class="va">size_1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">year</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">surv_data</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="va">repr_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">repr</span> <span class="op">~</span> <span class="va">size_1</span>, data <span class="op">=</span> <span class="va">repr_data</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="va">recr_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">recr</span> <span class="op">~</span> <span class="va">size_1</span>, data <span class="op">=</span> <span class="va">recr_data</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rcsz_mu</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">rcsz_data</span><span class="op">$</span><span class="va">size_2</span><span class="op">)</span></span>
<span><span class="va">rcsz_sd</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">rcsz_data</span><span class="op">$</span><span class="va">size_2</span><span class="op">)</span></span></code></pre></div>
<p>We could then extract the fixed coefficients with the
<code>fixef</code> method and the conditional modes of the random
effects via the <code>ranef</code> method:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta_gs</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef</a></span><span class="op">(</span><span class="va">grow_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alpha_g_yrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">grow_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta_ss</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef</a></span><span class="op">(</span><span class="va">surv_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alpha_s_yrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html" class="external-link">ranef</a></span><span class="op">(</span><span class="va">surv_mod</span><span class="op">)</span></span></code></pre></div>
<p>The non-mixed models can use the <code>coef</code> method to extract
a vector of coefficients:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repr_coef</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">repr_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">recr_coef</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">recr_mod</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to transform these values into something
<code>ipmr</code> can use. This must always be a <strong>named
list</strong> where the names of the list components are the names used
in the vital expressions or kernel formula. Transforming the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>s
is easier - the output from <code>fixef</code> is always a named vector,
so we just use <code><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list()</a></code> and change the names to whatever
we want to use. We then bundle it into one big list with all the fixed
coefficients.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">beta_gs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">g_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha_g"</span>, <span class="st">"beta_g"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">beta_ss</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha_s"</span>, <span class="st">"beta_s"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_p_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">recr_coef</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">f_p_list</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha_r_p"</span>, <span class="st">"beta_r_p"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_r_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">repr_coef</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_r_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha_r_r"</span>, <span class="st">"beta_r_r"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_d_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu_r_d <span class="op">=</span> <span class="va">rcsz_mu</span>, sigma_r_d <span class="op">=</span> <span class="va">rcsz_sd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_fixed_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">g_list</span>, <span class="va">s_list</span>, <span class="va">r_p_list</span>, <span class="va">r_r_list</span>, <span class="va">r_d_list</span><span class="op">)</span></span></code></pre></div>
<p>For the random effects, we probably need to do some a bit more
processing, though this really depends on which modeling framework you
use and the format of the outputs. For <code>lme4</code>, it looks like
this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_alpha_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">alpha_g_yrs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">g_alpha_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"alpha_g_"</span>, <span class="fl">2001</span><span class="op">:</span><span class="fl">2006</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s_alpha_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">alpha_s_yrs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">s_alpha_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"alpha_s_"</span>, <span class="fl">2001</span><span class="op">:</span><span class="fl">2006</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>First, we strip away all of <code>lme4</code>-related attributes with
<code><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist()</a></code>, then convert it to the flat list format that we
need. Next, we set the names. Now, we can combine it with our
<code>all_fixed_params</code> list and we have all of the parameters we
need for the kernel functions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">all_fixed_params</span>, <span class="va">g_alpha_list</span>, <span class="va">s_alpha_list</span><span class="op">)</span></span></code></pre></div>
<p>We are now ready to begin implementing the kernels. This model will
be a simple, density independent, stochastic kernel-resampled model. The
parts where the index syntax is used are highlighted by comments in the
code block:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_ipm</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/init_ipm.html">init_ipm</a></span><span class="op">(</span>sim_gen    <span class="op">=</span> <span class="st">"simple"</span>,</span>
<span>                  di_dd      <span class="op">=</span> <span class="st">"di"</span>, </span>
<span>                  det_stoch  <span class="op">=</span> <span class="st">"stoch"</span>,</span>
<span>                  kern_param <span class="op">=</span> <span class="st">"kern"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># The _yr index is appended as a suffix with an underscore. Notice how the formula</span></span>
<span>    <span class="co"># from Eq 2 is translated into the formula argument and the kernel name</span></span>
<span>    </span>
<span>    name             <span class="op">=</span> <span class="st">"P_yr"</span>,</span>
<span>    family           <span class="op">=</span> <span class="st">"CC"</span>,</span>
<span>    formula          <span class="op">=</span> <span class="va">s_yr</span> <span class="op">*</span> <span class="va">g_yr</span>,</span>
<span>    </span>
<span>    <span class="co"># We also modify each parameter name is indexed as well.</span></span>
<span>    <span class="co"># Here, I've split out the linear predictor and the inverse logit</span></span>
<span>    <span class="co"># transformation into separate steps to avoid over cluttering</span></span>
<span>    </span>
<span>    s_lin_p          <span class="op">=</span> <span class="va">alpha_s</span> <span class="op">+</span> <span class="va">alpha_s_yr</span> <span class="op">+</span> <span class="va">beta_s</span> <span class="op">*</span> <span class="va">z_1</span>,</span>
<span>    s_yr             <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="va">s_lin_p</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># We do the same with growth as we did with survival and the P_yr formula</span></span>
<span>    </span>
<span>    g_yr             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z_2</span>, <span class="va">mu_g_yr</span>, <span class="va">sigma_g</span><span class="op">)</span>,</span>
<span>    mu_g_yr          <span class="op">=</span> <span class="va">alpha_g</span> <span class="op">+</span> <span class="va">alpha_g_yr</span> <span class="op">+</span> <span class="va">beta_g</span> <span class="op">*</span> <span class="va">z_1</span>,</span>
<span>    </span>
<span>    data_list        <span class="op">=</span> <span class="va">all_params</span>,</span>
<span>    states           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># We signal that the kernel has parameter sets</span></span>
<span>    </span>
<span>    uses_par_sets    <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    </span>
<span>    <span class="co"># And provide the values that each index can take as a named list. </span></span>
<span>    <span class="co"># The name(s) in this list MUST match the index used in the expressions.</span></span>
<span>    </span>
<span>    par_set_indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>yr <span class="op">=</span> <span class="fl">2001</span><span class="op">:</span><span class="fl">2006</span><span class="op">)</span>,</span>
<span>    evict_cor        <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    evict_fun        <span class="op">=</span> <span class="fu"><a href="../reference/eviction.html">truncated_distributions</a></span><span class="op">(</span><span class="st">"norm"</span>, <span class="st">"g_yr"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># This kernel doesn't get anything special because there are no</span></span>
<span>  <span class="co"># time-varying parameter values.</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    name          <span class="op">=</span> <span class="st">"F"</span>,</span>
<span>    family        <span class="op">=</span> <span class="st">"CC"</span>,</span>
<span>    formula       <span class="op">=</span> <span class="va">r_p</span> <span class="op">*</span> <span class="va">r_r</span> <span class="op">*</span> <span class="va">r_d</span>,</span>
<span>    r_p_lin_p     <span class="op">=</span> <span class="va">alpha_r_p</span> <span class="op">+</span> <span class="va">beta_r_p</span> <span class="op">*</span> <span class="va">z_1</span>,</span>
<span>    r_p           <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span> <span class="op">-</span><span class="va">r_p_lin_p</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    r_r           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">alpha_r_r</span> <span class="op">+</span> <span class="va">beta_r_r</span> <span class="op">*</span> <span class="va">z_1</span><span class="op">)</span>,</span>
<span>    r_d           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z_2</span>, <span class="va">mu_r_d</span>, <span class="va">sigma_r_d</span><span class="op">)</span>,</span>
<span>    data_list     <span class="op">=</span> <span class="va">all_params</span>,</span>
<span>    states        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    evict_cor     <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    evict_fun     <span class="op">=</span> <span class="fu"><a href="../reference/eviction.html">truncated_distributions</a></span><span class="op">(</span><span class="st">"norm"</span>, <span class="st">"r_d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_impl</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/define_star.html">make_impl_args_list</a></span><span class="op">(</span></span>
<span>      kernel_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P_yr"</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>      int_rule     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"midpoint"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      state_start    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      state_end      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_domains</a></span><span class="op">(</span></span>
<span>    z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">10</span>, <span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_pop_state</a></span><span class="op">(</span></span>
<span>    n_z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/make_ipm.html">make_ipm</a></span><span class="op">(</span></span>
<span>    iterate    <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    iterations <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    kernel_seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2001</span><span class="op">:</span><span class="fl">2006</span>, size <span class="op">=</span> <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    normalize_pop_size <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="complicated">IPMs from discrete parameter sets and continuously varying
environments<a class="anchor" aria-label="anchor" href="#complicated"></a>
</h2>
<p>Sometimes, models will have discretely and continuously varying
components as functions of different variables. For example, a study
could consider multiple sites (discrete component) and spatial and/or
temporal fluctuations in the environment at each site (continuous
component). We’ll use a hypothetical study that models demography as a
function of environment across multiple sites to illustrate this.</p>
<p>We’ll implement a general IPM of a perennial plant species. Our data
will come from 6 sites, <code>"A"</code> - <code>"F"</code>, and the
vital rate intercepts for the plants will vary across each one. Its
seeds can either enter a seed bank or recruit immediately, producing
recruits at the next time step. We’ll pretend that data from the recruit
size distribution was pooled across sites, and so does not vary with
space. The seed bank will be age structured and its parameters will be
space- and time-invariant. Seeds in the first year can either survive
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><msub><mrow><mi>s</mi><mi>b</mi></mrow><mn>1</mn></msub></msub><annotation encoding="application/x-tex">s_{{sb}_1}</annotation></semantics></math>/<code>s_sb1</code>)
and recruit
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><msub><mrow><mi>s</mi><mi>b</mi></mrow><mn>1</mn></msub></msub><annotation encoding="application/x-tex">r_{{sb}_1}</annotation></semantics></math>),
or survive and become two year old seeds. Two year old seeds can either
survive
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><msub><mrow><mi>s</mi><mi>b</mi></mrow><mn>2</mn></msub></msub><annotation encoding="application/x-tex">s_{{sb}_2}</annotation></semantics></math>/<code>s_sb2</code>)
and recruit
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><msub><mrow><mi>s</mi><mi>b</mi></mrow><mn>2</mn></msub></msub><annotation encoding="application/x-tex">r_{{sb}_2}</annotation></semantics></math>/<code>r_sb2</code>)
or die.</p>
<p>The vital rate information fed into our hypothetical regression
models are
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>s</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msup><annotation encoding="application/x-tex">s^{site}</annotation></semantics></math>/<code>s_site</code>),
growth
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>g</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msup><annotation encoding="application/x-tex">g^{site}</annotation></semantics></math>/<code>g_site</code>),
probability of reproduction
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>c</mi><mi>p</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><annotation encoding="application/x-tex">c_{p}^{site}</annotation></semantics></math>/<code>c_p_site</code>),
and seed production
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>c</mi><mi>r</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><annotation encoding="application/x-tex">c_{r}^{site}</annotation></semantics></math>/<code>c_r_site</code>).
They are all functions of size (<code>z</code>) and environmental
covariates
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>θ</mi><mi>t</mi></msup><annotation encoding="application/x-tex">\theta^{t}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>θ</mi><mi>p</mi></msup><annotation encoding="application/x-tex">\theta^{p}</annotation></semantics></math>,
denoted together in the kernel formulas as just
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>).</p>
<p>The full IPM looks like this:</p>
<ol style="list-style-type: decimal">
<li><p><span class="math display">$$
n(z, t + 1) = \int_L^U [P^{site}(z', z,\theta) + r_i * F^{site}(z', z,
\theta)]n(z, t)dz +\\ s_{{sb}_1} * r_{{sb}_1} * sb_1(t) *  c_d(z') +
\\s_{{sb}_2} * r_{{sb}_2} * sb_2(t) * c_d(z')
$$</span></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><msub><mi>b</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>r</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msubsup><mo>∫</mo><mi>L</mi><mi>U</mi></msubsup><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mi>c</mi><mi>p</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msubsup><mi>c</mi><mi>r</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">sb_1(t + 1) = (1-r_i) * \int_L^U [c_p^{site}(z, \theta) * c_r^{site}(z,\theta)] n(z, t)dz</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><msub><mi>b</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>s</mi><msub><mrow><mi>s</mi><mi>b</mi></mrow><mn>1</mn></msub></msub><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>r</mi><msub><mrow><mi>s</mi><mi>b</mi></mrow><mn>1</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><mi>s</mi><msub><mi>b</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">sb_2(t + 1) = s_{{sb}_1} * (1-r_{{sb}_1}) * sb_1(t)</annotation></semantics></math></p></li>
</ol>
<p>The sub kernels are:</p>
<ol start="4" style="list-style-type: decimal">
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>P</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>s</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msup><mi>G</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P^{site}(z',z, \theta) = s^{site}(z, \theta) * G^{site}(z',z, \theta)</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>c</mi><mi>p</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msubsup><mi>c</mi><mi>r</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msub><mi>c</mi><mi>d</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F^{site}(z',z, \theta) = c_{{p}}^{site}(z, \theta) * c_{r}^{site}(z, \theta) * c_d(z')</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mi>t</mi></msup><mo>∼</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>μ</mi><mi>t</mi></msup><mo>,</mo><msup><mi>σ</mi><mi>t</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta^{t} \sim Norm(\mu^{t}, \sigma^{t})</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mi>p</mi></msup><mo>∼</mo><mi>G</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mi>p</mi></msup><mo>,</mo><msup><mi>β</mi><mi>p</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta^{p} \sim Gamma(\alpha^{p}, \beta^{p})</annotation></semantics></math></p></li>
</ol>
<p>And the size/climate dependent vital rate functions and example R
code are:</p>
<ol start="8" style="list-style-type: decimal">
<li>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>s</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>s</mi></msub><mo>+</mo><msubsup><mi>α</mi><mi>s</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msubsup><mi>β</mi><mi>s</mi><mi>z</mi></msubsup><mo>*</mo><mi>z</mi><mo>+</mo><msubsup><mi>β</mi><mi>s</mi><mi>t</mi></msubsup><mo>*</mo><msup><mi>θ</mi><mi>t</mi></msup><mo>+</mo><msubsup><mi>β</mi><mi>s</mi><mi>p</mi></msubsup><mo>*</mo><msup><mi>θ</mi><mi>p</mi></msup></mrow><annotation encoding="application/x-tex">Logit(s^{site}(z, \theta)) = (\alpha_s + \alpha_{s}^{site}) + \beta_s^{z} * z + \beta_s^{t} * \theta^{t} + \beta_s^{p} * \theta^{p}</annotation></semantics></math></p>
<ul>
<li>example R code:
<code>glmer(survival ~ size + temp + precip + (1 | site), data = my_surv_data, family = binomial())</code>
</li>
</ul>
</li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>G</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>f</mi><mi>G</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><msubsup><mi>μ</mi><mi>G</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>σ</mi><mi>G</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G^{site}(z',z,\theta) = f_G(z', \mu_G^{site}(z, \theta), \sigma_G)</annotation></semantics></math></p></li>
<li>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>μ</mi><mi>G</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><mi>G</mi></msub><mo>+</mo><msubsup><mi>α</mi><mi>G</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msubsup><mi>β</mi><mi>G</mi><mi>z</mi></msubsup><mo>*</mo><mi>z</mi><mo>+</mo><msubsup><mi>β</mi><mi>G</mi><mi>t</mi></msubsup><mo>*</mo><msup><mi>θ</mi><mi>t</mi></msup><mo>+</mo><msubsup><mi>β</mi><mi>G</mi><mi>p</mi></msubsup><mo>*</mo><msup><mi>θ</mi><mi>p</mi></msup></mrow><annotation encoding="application/x-tex">\mu_G^{site}(z, \theta) = (\alpha_G + \alpha_G^{site}) + \beta_G^{z} * z + \beta_G^{t} * \theta^{t} + \beta_G^{p} * \theta^{p}</annotation></semantics></math></p>
<ul>
<li>example R code:
<code>lmer(size_next ~ size + temp + precip + (1 | site), data = my_grow_data)</code>
</li>
</ul>
</li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>c</mi><mi>p</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><msub><mi>c</mi><mi>p</mi></msub></msub><mo>+</mo><msubsup><mi>α</mi><msub><mi>c</mi><mi>p</mi></msub><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msubsup><mi>β</mi><msub><mi>c</mi><mi>p</mi></msub><mi>z</mi></msubsup><mo>*</mo><mi>z</mi><mo>+</mo><msubsup><mi>β</mi><msub><mi>c</mi><mi>p</mi></msub><mi>t</mi></msubsup><mo>*</mo><msup><mi>θ</mi><mi>t</mi></msup><mo>+</mo><msubsup><mi>β</mi><msub><mi>c</mi><mi>p</mi></msub><mi>p</mi></msubsup><mo>*</mo><msup><mi>θ</mi><mi>p</mi></msup></mrow><annotation encoding="application/x-tex">Logit(c_{p}^{site}(z, \theta)) = (\alpha_{c_p} + \alpha_{c_p}^{site}) + \beta_{c_p}^{z} * z + \beta_{c_p}^{t} * \theta^{t} + \beta_{c_p}^{p} * \theta^{p}</annotation></semantics></math></p></li>
</ol>
<ul>
<li>example R code:
<code>glmer(repro ~ size + temp + precip + (1 | site), data = my_repro_data, family = binomial())</code>
</li>
</ul>
<ol start="12" style="list-style-type: decimal">
<li>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>c</mi><mi>r</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>α</mi><msub><mi>c</mi><mi>r</mi></msub></msub><mo>+</mo><msubsup><mi>α</mi><msub><mi>c</mi><mi>r</mi></msub><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msubsup><mi>β</mi><msub><mi>c</mi><mi>r</mi></msub><mi>z</mi></msubsup><mo>*</mo><mi>z</mi><mo>+</mo><msubsup><mi>β</mi><msub><mi>c</mi><mi>r</mi></msub><mi>t</mi></msubsup><mo>*</mo><msub><mi>θ</mi><mi>t</mi></msub><mo>+</mo><msubsup><mi>β</mi><msub><mi>c</mi><mi>r</mi></msub><mi>p</mi></msubsup><mo>*</mo><msub><mi>θ</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">log(c_{r}^{site}(z, \theta)) = (\alpha_{c_r} + \alpha_{c_r}^{site}) + \beta_{c_r}^{z} * z + \beta_{c_r}^{t} * \theta_{t} + \beta_{c_r}^{p} * \theta_{p}</annotation></semantics></math></p>
<ul>
<li>example R code:
<code>glmer(flower_n ~ size + temp + precip + (1 | site), data = my_flower_data, family = poisson())</code>
</li>
</ul>
</li>
<li>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>d</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>f</mi><msub><mi>c</mi><mi>d</mi></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><msub><mi>μ</mi><msub><mi>c</mi><mi>d</mi></msub></msub><mo>,</mo><msub><mi>σ</mi><msub><mi>c</mi><mi>d</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">c_d(z') = f_{c_d}(z', \mu_{c_d}, \sigma_{c_d})</annotation></semantics></math></p>
<ul>
<li>example R code:
<code>mean(my_recr_data$size_next); sd(my_recr_data$size_next)</code>
</li>
</ul>
</li>
</ol>
<div class="section level3">
<h3 id="simulating-parameters">Simulating parameters<a class="anchor" aria-label="anchor" href="#simulating-parameters"></a>
</h3>
<p>Since this example doesn’t work with actual data, we need to simulate
some parameters for each site. Additionally, we’ll specify the
distribution parameters for each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
and write a function that samples them once.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://padrinoDB.github.io/ipmr/" class="external-link">ipmr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">51</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the sites, and the parameters</span></span>
<span></span>
<span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span></span>
<span><span class="va">all_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  r_i       <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  r_sb1     <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  r_sb2     <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  s_sb1     <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  s_sb2     <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  mu_c_d    <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  sigma_c_d <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  sigma_g   <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  beta_s_z    <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  beta_s_prec <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  beta_s_temp <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,</span>
<span>  beta_g_z    <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  beta_g_prec <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  beta_g_temp <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  beta_c_p_z    <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  beta_c_p_prec <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  beta_c_p_temp <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>,</span>
<span>  beta_c_r_z    <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  beta_c_r_prec <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>,</span>
<span>  beta_c_r_temp <span class="op">=</span> <span class="fl">0.9</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">g_alphs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">6</span>, mean <span class="op">=</span> <span class="fl">4.5</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'alpha_g_'</span>, <span class="va">sites</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">s_alphs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">6</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">7</span>, sd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'alpha_s_'</span>, <span class="va">sites</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">c_p_alphs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">6</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'alpha_c_p_'</span>, <span class="va">sites</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">c_r_alphs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'alpha_c_r_'</span>, <span class="va">sites</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">all_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">all_pars</span>,</span>
<span>              <span class="va">g_alphs</span>, </span>
<span>              <span class="va">s_alphs</span>, </span>
<span>              <span class="va">c_p_alphs</span>,</span>
<span>              <span class="va">c_r_alphs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This list contains parameters that define the distributions for environmental</span></span>
<span><span class="co"># covariates</span></span>
<span></span>
<span><span class="va">env_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  temp_mu <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  temp_sd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  prec_shape <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  prec_rate  <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This function samples the environmental covariate distributions and returns</span></span>
<span><span class="co"># the values in a named list. We can reference the names in the list in our</span></span>
<span><span class="co"># vital rate expressions.</span></span>
<span></span>
<span><span class="va">sample_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">env_params</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">env_params</span><span class="op">$</span><span class="va">temp_mu</span>, <span class="va">env_params</span><span class="op">$</span><span class="va">temp_sd</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">prec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">env_params</span><span class="op">$</span><span class="va">prec_shape</span>, <span class="va">env_params</span><span class="op">$</span><span class="va">prec_rate</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">temp</span>,</span>
<span>               prec <span class="op">=</span> <span class="va">prec</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="implementing-the-model">Implementing the model<a class="anchor" aria-label="anchor" href="#implementing-the-model"></a>
</h3>
<p>We’ve written out our model - now we can implement it. We’ll use the
general, density independent, stochastic parameter resampled machinery
for this.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init_ipm.html">init_ipm</a></span><span class="op">(</span>sim_gen    <span class="op">=</span> <span class="st">"general"</span>,</span>
<span>                   di_dd      <span class="op">=</span> <span class="st">"di"</span>, </span>
<span>                   det_stoch  <span class="op">=</span> <span class="st">"stoch"</span>,</span>
<span>                   kern_param <span class="op">=</span> <span class="st">"param"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    </span>
<span>    name <span class="op">=</span> <span class="st">"P_site"</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"CC"</span>,</span>
<span>    </span>
<span>    <span class="co"># site is appended so that we don't have to write out s_A, s_B, etc.</span></span>
<span>    </span>
<span>    formula          <span class="op">=</span> <span class="va">s_site</span> <span class="op">*</span> <span class="va">g_site</span> <span class="op">*</span> <span class="va">d_z</span>,</span>
<span>    </span>
<span>    s_site_lin       <span class="op">=</span> <span class="va">alpha_s_site</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_s_z</span> <span class="op">*</span> <span class="va">z_1</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_s_prec</span> <span class="op">*</span> <span class="va">prec</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_s_temp</span> <span class="op">*</span> <span class="va">temp</span>,</span>
<span>    s_site           <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">s_site_lin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    mu_g_site        <span class="op">=</span> <span class="va">alpha_g_site</span> <span class="op">+</span></span>
<span>                       <span class="va">beta_g_z</span> <span class="op">*</span> <span class="va">z_1</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_g_prec</span> <span class="op">*</span> <span class="va">prec</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_g_temp</span> <span class="op">*</span> <span class="va">temp</span>,</span>
<span>    g_site           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z_2</span>, <span class="va">mu_g_site</span>, <span class="va">sigma_g</span><span class="op">)</span>,</span>
<span>    data_list        <span class="op">=</span> <span class="va">all_pars</span>,</span>
<span>    states           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets    <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    par_set_indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>site <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    evict_cor        <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    evict_fun        <span class="op">=</span> <span class="fu"><a href="../reference/eviction.html">truncated_distributions</a></span><span class="op">(</span><span class="st">"norm"</span>, <span class="st">"g_site"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    name             <span class="op">=</span> <span class="st">"F_site"</span>,</span>
<span>    family           <span class="op">=</span> <span class="st">"CC"</span>,</span>
<span>    formula          <span class="op">=</span> <span class="va">c_p_site</span> <span class="op">*</span> <span class="va">c_r_site</span> <span class="op">*</span> <span class="va">c_d</span> <span class="op">*</span> <span class="va">d_z</span>,</span>
<span>    c_p_site_lin     <span class="op">=</span> <span class="va">alpha_c_p_site</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_c_p_z</span> <span class="op">*</span> <span class="va">z_1</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_c_p_prec</span> <span class="op">*</span> <span class="va">prec</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_c_p_temp</span> <span class="op">*</span> <span class="va">temp</span>,</span>
<span>    c_p_site         <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">c_p_site_lin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    c_r_site         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">alpha_c_r_site</span> <span class="op">+</span> </span>
<span>                           <span class="va">beta_c_r_z</span> <span class="op">*</span> <span class="va">z_1</span> <span class="op">+</span></span>
<span>                           <span class="va">beta_c_r_prec</span> <span class="op">*</span> <span class="va">prec</span> <span class="op">+</span></span>
<span>                           <span class="va">beta_c_r_temp</span> <span class="op">*</span> <span class="va">temp</span><span class="op">)</span>,</span>
<span>    c_d              <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z_2</span>, <span class="va">mu_c_d</span>, <span class="va">sigma_c_d</span><span class="op">)</span>,</span>
<span>    data_list        <span class="op">=</span> <span class="va">all_pars</span>,</span>
<span>    states           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="st">"sb1"</span>, <span class="st">"sb2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets    <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    par_set_indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>site <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    evict_cor        <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    evict_fun        <span class="op">=</span> <span class="fu"><a href="../reference/eviction.html">truncated_distributions</a></span><span class="op">(</span><span class="st">"norm"</span>, <span class="st">"c_d"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    name             <span class="op">=</span> <span class="st">"go_sb_1_site"</span>,</span>
<span>    family           <span class="op">=</span> <span class="st">"CD"</span>,</span>
<span>    formula          <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">r_i</span><span class="op">)</span> <span class="op">*</span> <span class="va">c_p_site</span> <span class="op">*</span> <span class="va">c_r_site</span> <span class="op">*</span> <span class="va">d_z</span>,</span>
<span>    c_p_site_lin     <span class="op">=</span> <span class="va">alpha_c_p_site</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_c_p_z</span> <span class="op">*</span> <span class="va">z_1</span> <span class="op">+</span> </span>
<span>                       <span class="va">beta_c_p_prec</span> <span class="op">*</span> <span class="va">prec</span> <span class="op">+</span></span>
<span>                       <span class="va">beta_c_p_temp</span> <span class="op">*</span> <span class="va">temp</span>,</span>
<span>    c_p_site         <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">c_p_site_lin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    c_r_site         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">alpha_c_r_site</span> <span class="op">+</span> </span>
<span>                           <span class="va">beta_c_r_z</span> <span class="op">*</span> <span class="va">z_1</span> <span class="op">+</span> </span>
<span>                           <span class="va">beta_c_r_prec</span> <span class="op">*</span> <span class="va">prec</span> <span class="op">+</span> </span>
<span>                           <span class="va">beta_c_r_temp</span> <span class="op">*</span> <span class="va">temp</span><span class="op">)</span>,</span>
<span>    data_list        <span class="op">=</span> <span class="va">all_pars</span>,</span>
<span>    states           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="st">"sb1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets    <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    par_set_indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>site <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    evict_cor        <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    name          <span class="op">=</span> <span class="st">"go_sb_2"</span>,</span>
<span>    family        <span class="op">=</span> <span class="st">"DD"</span>,</span>
<span>    formula       <span class="op">=</span> <span class="va">s_sb1</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">r_sb1</span><span class="op">)</span>,</span>
<span>    data_list     <span class="op">=</span> <span class="va">all_pars</span>,</span>
<span>    states        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sb1"</span>, <span class="st">"sb2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    evict_cor     <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    name          <span class="op">=</span> <span class="st">"leave_sb_1"</span>,</span>
<span>    family        <span class="op">=</span> <span class="st">"DC"</span>,</span>
<span>    formula       <span class="op">=</span> <span class="va">s_sb1</span> <span class="op">*</span> <span class="va">r_sb1</span> <span class="op">*</span> <span class="va">c_d</span>,</span>
<span>    c_d           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z_2</span>, <span class="va">mu_c_d</span>, <span class="va">sigma_c_d</span><span class="op">)</span>,</span>
<span>    data_list     <span class="op">=</span> <span class="va">all_pars</span>,</span>
<span>    states        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="st">"sb1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    evict_cor     <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    evict_fun     <span class="op">=</span> <span class="fu"><a href="../reference/eviction.html">truncated_distributions</a></span><span class="op">(</span><span class="st">"norm"</span>, <span class="st">"c_d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    name          <span class="op">=</span> <span class="st">"leave_sb_2"</span>,</span>
<span>    family        <span class="op">=</span> <span class="st">"DC"</span>,</span>
<span>    formula       <span class="op">=</span> <span class="va">s_sb2</span> <span class="op">*</span> <span class="va">r_sb2</span> <span class="op">*</span> <span class="va">c_d</span>,</span>
<span>    c_d           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z_2</span>, <span class="va">mu_c_d</span>, <span class="va">sigma_c_d</span><span class="op">)</span>,</span>
<span>    data_list     <span class="op">=</span> <span class="va">all_pars</span>,</span>
<span>    states        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="st">"sb2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    evict_cor     <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    evict_fun     <span class="op">=</span> <span class="fu"><a href="../reference/eviction.html">truncated_distributions</a></span><span class="op">(</span><span class="st">"norm"</span>, <span class="st">"c_d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_impl</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/define_star.html">make_impl_args_list</a></span><span class="op">(</span></span>
<span>      kernel_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P_site"</span>,</span>
<span>                       <span class="st">"F_site"</span>,</span>
<span>                       <span class="st">"go_sb_1_site"</span>,</span>
<span>                       <span class="st">"go_sb_2"</span>, </span>
<span>                       <span class="st">"leave_sb_1"</span>, </span>
<span>                       <span class="st">"leave_sb_2"</span><span class="op">)</span>,</span>
<span>      int_rule     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"midpoint"</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>      state_start    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="st">"z"</span>, <span class="st">"z"</span>, <span class="st">"sb1"</span>, <span class="st">"sb1"</span>, <span class="st">"sb2"</span><span class="op">)</span>,</span>
<span>      state_end      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="st">"z"</span>, <span class="st">"sb1"</span>, <span class="st">"sb2"</span>, <span class="st">"z"</span>, <span class="st">"z"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_domains</a></span><span class="op">(</span></span>
<span>    z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_pop_state</a></span><span class="op">(</span></span>
<span>    n_z   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>,</span>
<span>    n_sb1 <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    n_sb2 <span class="op">=</span> <span class="fl">20</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_env_state</a></span><span class="op">(</span></span>
<span>    env_state <span class="op">=</span> <span class="fu">sample_fun</span><span class="op">(</span><span class="va">env_params</span><span class="op">)</span>,</span>
<span>    data_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>env_params <span class="op">=</span> <span class="va">env_params</span>,</span>
<span>                     sample_fun <span class="op">=</span> <span class="va">sample_fun</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="../reference/make_ipm.html">make_ipm</a></span><span class="op">(</span></span>
<span>    iterations         <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    kernel_seq         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, <span class="fl">20</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    normalize_pop_size <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/lambda.html">lambda</a></span><span class="op">(</span><span class="va">ex_ipm</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/levisc8" class="external-link">Sam Levin</a>, Aldo Compagnoni, Dylan Childs, Sanne Evers, Roberto Salguero-Gomez, Tiffany Knight.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
