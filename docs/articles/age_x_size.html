<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Age-Size IPMs • ipmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Age-Size IPMs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipmr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ipmr-introduction.html">Introduction to ipmr</a>
    </li>
    <li>
      <a href="../articles/general-ipms.html">General IPMs</a>
    </li>
    <li>
      <a href="../articles/index-notation.html">Index Notation in ipmr</a>
    </li>
    <li>
      <a href="../articles/age_x_size.html">Age X Size IPMs</a>
    </li>
    <li>
      <a href="../articles/density-dependence.html">Density/Frequency Dependent IPMs</a>
    </li>
    <li>
      <a href="../articles/proto-ipms.html">proto_ipm Data Structure</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/padrinoDB/ipmr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Age-Size IPMs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/padrinoDB/ipmr/blob/main/vignettes/age_x_size.Rmd" class="external-link"><code>vignettes/age_x_size.Rmd</code></a></small>
      <div class="hidden name"><code>age_x_size.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-age-times-size-classified-models">Introduction to age
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>×</mo><annotation encoding="application/x-tex">\times</annotation></semantics></math>
size classified models<a class="anchor" aria-label="anchor" href="#introduction-to-age-times-size-classified-models"></a>
</h2>
<p>Many species exhibit age-dependent demography in addition to some
other continuous measures of size. Long term, age classified data sets
aren’t nearly as common as non-age classified data sets, but can be
exceptionally insightful when available. <code>ipmr</code> includes some
methods to deal with specifying them.</p>
<p>While we may be tempted to think of age as a continuous quantity, it
must be a discrete state in a discrete time model. This makes the age
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>×</mo><annotation encoding="application/x-tex">\times</annotation></semantics></math>
size IPM a special case of the general IPM. This also uses the parameter
index syntax, and it is largely the same as for other, non-age
structured IPMs, but includes a couple extra bits that must be
specified.</p>
<p>The rest of this vignette assumes you are familiar with the suffix
notation that <code>ipmr</code> uses. If you haven’t already covered
this, it would be best to read at least the <a href="https://padrinoDB.github.io/ipmr/articles/ipmr-introduction.html" class="external-link">Intro</a>
and <a href="https://padrinoDB.github.io/ipmr/articles/general-ipms.html" class="external-link">General
IPM</a> vignettes before continuing. We’ll model Soay sheep (<em>Ovis
aries</em>) from St. Kilda using parameters from Chapter 6 of Ellner,
Childs, &amp; Rees (2016).</p>
</div>
<div class="section level2">
<h2 id="mathematical-overview">Mathematical overview<a class="anchor" aria-label="anchor" href="#mathematical-overview"></a>
</h2>
<p>The deterministic form of an age
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>×</mo><annotation encoding="application/x-tex">\times</annotation></semantics></math>
size model is generally:</p>
<ol style="list-style-type: decimal">
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>a</mi><mo>=</mo><mn>0</mn></mrow><mi>M</mi></munderover><msubsup><mo>∫</mo><mi>L</mi><mi>U</mi></msubsup><msub><mi>F</mi><mi>a</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>n</mi><mi>a</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">n_0(z',t+1) = \sum\limits_{a=0}^M \int_L^UF_a(z',z)n_a(z,t)dz</annotation></semantics></math></li>
</ol>
<p>and</p>
<ol start="2" style="list-style-type: decimal">
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>a</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mi>L</mi><mi>U</mi></msubsup><msub><mi>P</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>n</mi><mrow><mi>a</mi><mo>−</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">n_a(z',t+1) = \int_L^U P_{a-1}(z',z)n_{a-1}(z,t)dz</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">a = 1,2,...,M</annotation></semantics></math>
</li>
</ol>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
indicates the maximum age beyond which we assume no individuals can
survive. If we aren’t comfortable with that assumption, then we can add
a third equation to specify the number of individuals in the
“<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">M+1</annotation></semantics></math>
or older” age class:</p>
<ol start="3" style="list-style-type: decimal">
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mrow><mi>M</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mi>L</mi><mi>U</mi></msubsup><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>P</mi><mi>M</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>n</mi><mi>M</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>P</mi><mrow><mi>M</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>n</mi><mrow><mi>M</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>d</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">n_{M+1}(z',t+1) = \int_L^U[P_M(z',z)n_M(z,t) + P_{M+1}(z',z)n_{M+1}(z,t)]dz</annotation></semantics></math></li>
</ol>
<p>If we do this, then the upper limit in the sum of Eq 1 must be
modified to include
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">M+1</annotation></semantics></math>.
The Soay sheep model we are about to work on includes this
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">M+1</annotation></semantics></math>
age group.</p>
<p>The sub-kernels in this model are formed using regression models
for:</p>
<ul>
<li><p>survival
(<code>s_age</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s(z,a)</annotation></semantics></math>)</p></li>
<li><p>growth
(<code>g_age</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G(z',z,a)</annotation></semantics></math>)</p></li>
<li><p>probability of adults reproducing
(<code>pb_age</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>b</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p_b(z,a)</annotation></semantics></math>)</p></li>
<li><p>probability that a recruit survives to the first census
(<code>pr_age</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>r</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p_r(a)</annotation></semantics></math>)</p></li>
<li><p>recruit size distribution
(<code>rcsz</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>d</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">C_d(z',z)</annotation></semantics></math>).
The recruit size distribution has a maternal effect of parental weight
on recruit weight.</p></li>
</ul>
<p>The sub-kernels have the following form:</p>
<ol start="4" style="list-style-type: decimal">
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>a</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><mi>G</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_a(z', z, a) = s(z, a) * G(z', z, a)</annotation></semantics></math></p></li>
<li>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>a</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msub><mi>p</mi><mi>b</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msub><mi>p</mi><mi>r</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><msub><mi>C</mi><mi>d</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>*</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">F_a(z', z, a) = s(z, a) * p_b(z, a) * p_r(a) * C_d(z', z) * 0.5</annotation></semantics></math></p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mn>0</mn></msub><mo>≡</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">F_0 \equiv 0</annotation></semantics></math>
so that age-0 recruits cannot reproduce.</p></li>
<li><p>This model only tracks females. Assuming an equal sex ratio, we
multiply the fecundity kernels by 0.5. We could change the weighting
based on observed data.</p></li>
</ul>
</li>
</ol>
<p>The vital rates are as follows:</p>
<ol start="6" style="list-style-type: decimal">
<li>
<p>Survival
(<code>s_age</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s(z,a)</annotation></semantics></math>):
A logistic regression with size and age as fixed effects.</p>
<ul>
<li><p>Example code:
<code>glm(surv ~ size + age, data = survival_data, family = binomial())</code></p></li>
<li><p>Mathematical form:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mi>s</mi></msub><mo>+</mo><msubsup><mi>β</mi><mi>s</mi><mi>z</mi></msubsup><mo>*</mo><mi>z</mi><mo>+</mo><msubsup><mi>β</mi><mi>s</mi><mi>a</mi></msubsup><mo>*</mo><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Logit(s(z,a)) = \alpha_s + \beta_s^z * z + \beta_s^a *age</annotation></semantics></math></p></li>
</ul>
</li>
<li>
<p>Growth
(<code>g_age</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G(z',z,a)</annotation></semantics></math>):
A linear model with size and age as fixed effects.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mi>G</mi></msub><annotation encoding="application/x-tex">f_G</annotation></semantics></math>
denotes a normal probability density function.</p>
<ul>
<li><p>Example code:
<code>lm(size_next ~ size + age, data = growth data)</code></p></li>
<li>
<p>Mathematical form:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>f</mi><mi>G</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>G</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>σ</mi><mi>G</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G(z',z,a) = f_G(\mu_G(z, a), \sigma_G)</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>G</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mi>G</mi></msub><mo>+</mo><msubsup><mi>β</mi><mi>G</mi><mi>z</mi></msubsup><mo>*</mo><mi>z</mi><mo>+</mo><msubsup><mi>β</mi><mi>G</mi><mi>a</mi></msubsup><mo>*</mo><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">\mu_G(z, a) = \alpha_G + \beta_G^z * z + \beta_G^a * age</annotation></semantics></math></p></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Probability of reproduction
(<code>pb_age</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>b</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p_b(z,a)</annotation></semantics></math>):
A logistic regression with size and age as fixed effects.</p>
<ul>
<li><p>Example code:
<code>glm(repr ~ size + age, data = repr_data, family = binomial())</code></p></li>
<li><p>Mathematical form:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>b</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><msub><mi>p</mi><mi>b</mi></msub></msub><mo>+</mo><msubsup><mi>β</mi><msub><mi>p</mi><mi>b</mi></msub><mi>z</mi></msubsup><mo>*</mo><mi>z</mi><mo>+</mo><msubsup><mi>β</mi><msub><mi>p</mi><mi>b</mi></msub><mi>a</mi></msubsup><mo>*</mo><mi>a</mi><mi>g</mi><mi>e</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">Logit(p_b(z,a)) = \alpha_{p_b} + \beta_{p_b}^z * z + \beta_{p_b}^a * age)</annotation></semantics></math></p></li>
</ul>
</li>
<li>
<p>Probability of recruitment
(<code>pr_age</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>r</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p_r(a)</annotation></semantics></math>):
A logistic regression with age as a fixed effect.</p>
<ul>
<li><p>Example code:
<code>glm(recr ~ age, data = recr_data, family = binomial())</code></p></li>
<li><p>Mathematical form:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>o</mi><mi>g</mi><mi>i</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>r</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><msub><mi>p</mi><mi>r</mi></msub></msub><mo>+</mo><msubsup><mi>β</mi><msub><mi>p</mi><mi>r</mi></msub><mi>a</mi></msubsup><mo>*</mo><mi>a</mi><mi>g</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Logit(p_r(a)) = \alpha_{p_r} + \beta_{p_r}^a * age</annotation></semantics></math></p></li>
</ul>
</li>
<li>
<p>Recruit size distribution
(<code>rcsz</code>/<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>d</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">C_d(z',z)</annotation></semantics></math>):
A linear model with parent size as a fixed effect.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><msub><mi>C</mi><mi>d</mi></msub></msub><annotation encoding="application/x-tex">f_{C_d}</annotation></semantics></math>
denotes a normal probability density function.</p>
<ul>
<li><p>Example code:
<code>lm(rcsz ~ size, data = rcsz_data)</code></p></li>
<li>
<p>Mathematical form:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>d</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mi>′</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>f</mi><msub><mi>C</mi><mi>d</mi></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><msub><mi>C</mi><mi>d</mi></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>σ</mi><msub><mi>C</mi><mi>d</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">C_d(z',z) = f_{C_d}(\mu_{C_d}(z), \sigma_{C_d})</annotation></semantics></math></p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><msub><mi>C</mi><mi>d</mi></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><msub><mi>C</mi><mi>d</mi></msub></msub><mo>+</mo><msubsup><mi>β</mi><msub><mi>C</mi><mi>d</mi></msub><mi>z</mi></msubsup><mo>*</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">\mu_{C_d}(z) = \alpha_{C_d} + \beta_{C_d}^z * z</annotation></semantics></math></p></li>
</ul>
</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="model-parameterization">Model parameterization<a class="anchor" aria-label="anchor" href="#model-parameterization"></a>
</h2>
<p>This example directly reproduces the model found in Ellner, Rees
&amp; Childs (2016), chapter 6.2. The code that implements that version
can be found <a href="https://github.com/ipmbook/first-edition/tree/master/Rcode/c6" class="external-link">here</a>.
This example will skip the IBM simulation and model fitting and just
focus on the new syntax (<code>ipmr</code> doesn’t .</p>
<p>First, we set up our parameter list and define a couple functions to
help out. The <code>f_fun</code> is used to wrap <code>formula</code>
argument in <code>"F_age"</code> kernel so that we can concisely express
that age-0 individuals do not reproduce. Note that it is not possible to
use an <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code> statement instead, because <code>age</code>
will be a single number, and <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code> always returns a
value that is the same length as its input (and we want the return value
to be a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mo>×</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">100\times100</annotation></semantics></math>
matrix).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://padrinoDB.github.io/ipmr/" class="external-link">ipmr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">param_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  surv_int <span class="op">=</span> <span class="op">-</span><span class="fl">17</span>, </span>
<span>  surv_z <span class="op">=</span> <span class="fl">6.68</span>,</span>
<span>  surv_a <span class="op">=</span> <span class="op">-</span><span class="fl">0.334</span>, </span>
<span>  grow_int <span class="op">=</span> <span class="fl">1.27</span>, </span>
<span>  grow_z <span class="op">=</span> <span class="fl">0.612</span>, </span>
<span>  grow_a <span class="op">=</span> <span class="op">-</span><span class="fl">0.00724</span>,</span>
<span>  grow_sd <span class="op">=</span> <span class="fl">0.0787</span>,</span>
<span>  repr_int <span class="op">=</span> <span class="op">-</span><span class="fl">7.88</span>, </span>
<span>  repr_z <span class="op">=</span> <span class="fl">3.11</span>,</span>
<span>  repr_a <span class="op">=</span> <span class="op">-</span><span class="fl">0.078</span>, </span>
<span>  recr_int <span class="op">=</span> <span class="fl">1.11</span>, </span>
<span>  recr_a <span class="op">=</span> <span class="fl">0.184</span>, </span>
<span>  rcsz_int <span class="op">=</span> <span class="fl">0.362</span>,</span>
<span>  rcsz_z <span class="op">=</span> <span class="fl">0.709</span>, </span>
<span>  rcsz_sd <span class="op">=</span> <span class="fl">0.159</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">inv_logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">f_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age</span>, <span class="va">s_age</span>, <span class="va">pb_age</span>, <span class="va">pr_age</span>, <span class="va">recr</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">age</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">s_age</span> <span class="op">*</span> <span class="va">pb_age</span> <span class="op">*</span> <span class="va">pr_age</span> <span class="op">*</span> <span class="va">recr</span> <span class="op">*</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, we begin to initialize our kernels. <code>init_ipm</code> now
has a fifth argument - <code>uses_age</code>. This is a logical and
denotes that we are specifying a model with individuals cross-classified
by both age and size. The <code>sim_gen</code> argument is
<code>"general</code>“, because age-size models are always general IPMs,
and <code>det_stoch = "det"</code> because we are only working on a
deterministic version of this model for now. We’ll append the
<code>_age</code> index to every variable that is age dependent.
Additionally, we can use <code>age</code> as a standalone term - these
will be substituted during the model building as well.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_size_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init_ipm.html">init_ipm</a></span><span class="op">(</span>sim_gen    <span class="op">=</span> <span class="st">"general"</span>,</span>
<span>                         di_dd      <span class="op">=</span> <span class="st">"di"</span>, </span>
<span>                         det_stoch  <span class="op">=</span> <span class="st">"det"</span>,</span>
<span>                         uses_age    <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    name          <span class="op">=</span> <span class="st">"P_age"</span>,</span>
<span>    family        <span class="op">=</span> <span class="st">"CC"</span>,</span>
<span>    formula       <span class="op">=</span> <span class="va">s_age</span> <span class="op">*</span> <span class="va">g_age</span> <span class="op">*</span> <span class="va">d_wt</span>,</span>
<span>    s_age         <span class="op">=</span> <span class="fu">inv_logit</span><span class="op">(</span><span class="va">surv_int</span> <span class="op">+</span> <span class="va">surv_z</span> <span class="op">*</span> <span class="va">wt_1</span> <span class="op">+</span> <span class="va">surv_a</span> <span class="op">*</span> <span class="va">age</span><span class="op">)</span>,</span>
<span>    g_age         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">wt_2</span>, <span class="va">mu_g_age</span>, <span class="va">grow_sd</span><span class="op">)</span>,</span>
<span>    mu_g_age      <span class="op">=</span> <span class="va">grow_int</span> <span class="op">+</span> <span class="va">grow_z</span> <span class="op">*</span> <span class="va">wt_1</span> <span class="op">+</span> <span class="va">grow_a</span> <span class="op">*</span> <span class="va">age</span>,</span>
<span>    data_list     <span class="op">=</span> <span class="va">param_list</span>,</span>
<span>    states        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    age_indices   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>, max_age <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,</span>
<span>    evict_cor     <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The primary difference in defining this kernel vs any other indexed
model is that we now specify <code>uses_par_sets = FALSE</code>, and
pass a list to <code>age_indices</code> instead of
<code>par_set_indices</code>. <code>age_indices</code> takes a list with
at least one, but possibly two components:</p>
<ol style="list-style-type: decimal">
<li><p><code>age</code>: This is the age range for the model. It should
always start from 0 and be a sequence of integers.</p></li>
<li><p>Optionally, <code>max_age</code>: This is used to denote that
while individuals may get older in reality, this value will be the
highest that we model. In effect, it creates “very old, but not quite
dead” group which can survive and remain in the same age class.</p></li>
</ol>
<p>Next, we continue defining the models as we did before.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_size_ipm</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>    proto_ipm     <span class="op">=</span> <span class="va">age_size_ipm</span>,</span>
<span>    name          <span class="op">=</span> <span class="st">"F_age"</span>,</span>
<span>    family        <span class="op">=</span> <span class="st">"CC"</span>,</span>
<span>    formula       <span class="op">=</span> <span class="fu">f_fun</span><span class="op">(</span><span class="va">age</span>, <span class="va">s_age</span>, <span class="va">pb_age</span>, <span class="va">pr_age</span>, <span class="va">rcsz</span><span class="op">)</span> <span class="op">*</span> <span class="va">d_wt</span>,</span>
<span>    s_age         <span class="op">=</span> <span class="fu">inv_logit</span><span class="op">(</span><span class="va">surv_int</span> <span class="op">+</span> <span class="va">surv_z</span> <span class="op">*</span> <span class="va">wt_1</span> <span class="op">+</span> <span class="va">surv_a</span> <span class="op">*</span> <span class="va">age</span><span class="op">)</span>,</span>
<span>    pb_age        <span class="op">=</span> <span class="fu">inv_logit</span><span class="op">(</span><span class="va">repr_int</span> <span class="op">+</span> <span class="va">repr_z</span> <span class="op">*</span> <span class="va">wt_1</span> <span class="op">+</span> <span class="va">repr_a</span> <span class="op">*</span> <span class="va">age</span><span class="op">)</span>,</span>
<span>    pr_age        <span class="op">=</span> <span class="fu">inv_logit</span><span class="op">(</span><span class="va">recr_int</span> <span class="op">+</span> <span class="va">recr_a</span> <span class="op">*</span> <span class="va">age</span><span class="op">)</span>,</span>
<span>    rcsz          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">wt_2</span>, <span class="va">rcsz_mu</span>, <span class="va">rcsz_sd</span><span class="op">)</span>,</span>
<span>    rcsz_mu       <span class="op">=</span> <span class="va">rcsz_int</span> <span class="op">+</span> <span class="va">rcsz_z</span> <span class="op">*</span> <span class="va">wt_1</span>,</span>
<span>    data_list     <span class="op">=</span> <span class="va">param_list</span>,</span>
<span>    states        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    uses_par_sets <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    age_indices   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>, max_age <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,</span>
<span>    evict_cor     <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The <code>"F_age"</code> kernel has a custom function in the
<code>formula</code> slot that allows us to always set fecundity for
age-0 individuals to 0. We also add <code>_age</code> suffixes and
<code>age</code> terms to the appropriate equations.</p>
<p>Our call to <code><a href="../reference/define_star.html">define_impl()</a></code> will look a little different.
In examples in the other vignettes using the index syntax, we never
added indices to <code>state_start</code>/<code>state_end</code>.
However, we need to append them here. This is because we have to make
sure that our <code>P_age</code> kernels produce <code>wt_age</code>
individuals, whereas our <code>F_age</code> kernels must produce
<code>wt_0</code> individuals (i.e. only age-0 lambs). We do this using
the <code>state_start</code> and <code>state_end</code> arguments.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_size_ipm</span> <span class="op">&lt;-</span> <span class="va">age_size_ipm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_impl</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/define_star.html">make_impl_args_list</a></span><span class="op">(</span></span>
<span>      kernel_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P_age"</span>, <span class="st">"F_age"</span><span class="op">)</span>,</span>
<span>      int_rule     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"midpoint"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      state_start    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt_age"</span>, <span class="st">"wt_age"</span><span class="op">)</span>,</span>
<span>      state_end      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt_age"</span>, <span class="st">"wt_0"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>The rest of the steps are largely similar to previous examples:</p>
<ol style="list-style-type: decimal">
<li><p><code><a href="../reference/define_star.html">define_domains()</a></code> is exactly the same.</p></li>
<li><p><code><a href="../reference/define_star.html">define_pop_state()</a></code>: we append <code>_age</code>
suffix again here, because we want to track individual weights within
age groups. This will create 22 copies of the <code>wt</code> domain, 1
for each <code>age_indices</code>.</p></li>
<li><p>Optionally, <code><a href="../reference/define_star.html">define_env_state()</a></code> (though not here
because it’s a deterministic model)</p></li>
<li><p><code><a href="../reference/make_ipm.html">make_ipm()</a></code> is exactly the same.</p></li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_size_ipm</span> <span class="op">&lt;-</span> <span class="va">age_size_ipm</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_domains</a></span><span class="op">(</span></span>
<span>    wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">3.7</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/define_star.html">define_pop_state</a></span><span class="op">(</span></span>
<span>    n_wt_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/make_ipm.html">make_ipm</a></span><span class="op">(</span></span>
<span>    usr_funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>inv_logit <span class="op">=</span> <span class="va">inv_logit</span>,</span>
<span>                    f_fun     <span class="op">=</span> <span class="va">f_fun</span><span class="op">)</span>,</span>
<span>    iterate  <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    iterations <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">lam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lambda.html">lambda</a></span><span class="op">(</span><span class="va">age_size_ipm</span><span class="op">)</span></span>
<span><span class="va">lam</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="further-analyses">Further analyses<a class="anchor" aria-label="anchor" href="#further-analyses"></a>
</h2>
<p>There are a number of other calculations that we can perform using
functions provided by <code>ipmr</code>. <code><a href="../reference/eigenvectors.html">left_ev()</a></code> and
<code>right_ev</code> also work for age
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>×</mo><annotation encoding="application/x-tex">\times</annotation></semantics></math>
size models. We’ll extract them and plot their values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eigenvectors.html">left_ev</a></span><span class="op">(</span><span class="va">age_size_ipm</span>, iterations <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">w_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eigenvectors.html">right_ev</a></span><span class="op">(</span><span class="va">age_size_ipm</span>, iterations <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">w_a</span><span class="op">)</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"w"</span><span class="op">[</span><span class="va">a</span><span class="op">]</span>,<span class="st">"(z)"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Size bin"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">w_a</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">w_a</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, </span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">v_a</span><span class="op">)</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"v"</span><span class="op">[</span><span class="va">a</span><span class="op">]</span>, <span class="st">"(z)"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Size bin"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">v_a</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">v_a</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/levisc8" class="external-link">Sam Levin</a>, Aldo Compagnoni, Dylan Childs, Sanne Evers, Roberto Salguero-Gomez, Tiffany Knight.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
