<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fits IPMs using an expression based framework  • ipmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Fits IPMs using an expression based framework ">
<meta property="og:description" content="Flexibly implements IPMs using an expression based framework. This
  will not abstract away the model selection process, but it will make sure you
  get everything after that correct. It handles density dependence and environmental
  stochasticity, with a couple of options for implementing the latter. Additionally,
  provides model diagnostic tools, plotting functionality, stochastic/deterministic
  simulations, and analysis tools.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ipmr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Introduction to ipmr</li>
    <li>
      <a href="articles/ipmr-introduction.html">Introduction to ipmr</a>
    </li>
    <li>
      <a href="articles/general-ipms.html">General IPMs</a>
    </li>
    <li>
      <a href="articles/hierarchical-notation.html">Hierarchical Notation</a>
    </li>
    <li>
      <a href="articles/age_x_size.html">Age-Size IPMs</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Generic Functions</li>
    <li>
      <a href="articles/generic-funs.html">List of Generic and Helper Functions in ipmr</a>
    </li>
    <li>
      <a href="articles/generic-progress.html">Generic Progress</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">proto_ipm Overview</li>
    <li>
      <a href="articles/proto-ipms.html">proto_ipm data structure</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">ipmr Checks</li>
    <li>
      <a href="articles/sanity-checks.html">Sanity checks for ipmr examples</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="ipmr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#ipmr" class="anchor"></a>ipmr</h1></div>
<p><code>ipmr</code> is a package for implementing Integral Projection Models (IPMs) in <em>R</em>. It relies heavily on the mathematical syntax of the models, and does not try to abstract over the process of fitting vital rates. It is still very much a work in progress, and so models implemented using current code may not run in the not-so-distant future as more complicated methods are brought online and tweaks are made. Below is a brief overview of how <code>ipmr</code> classifies different model types followed by examples of how to implement those types in this framework.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p><code>ipmr</code> is not yet on CRAN. You can install the development version with the snippet below:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">'remotes'</span>, <span class="kw">quietly</span> <span class="kw">=</span> <span class="fl">TRUE</span>)) {
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)
}

<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"levisc8/ipmr"</span>, <span class="kw">build_vignettes</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></div>
</div>
<div id="package-scope" class="section level2">
<h2 class="hasAnchor">
<a href="#package-scope" class="anchor"></a>Package scope</h2>
<p>Note that this package <strong>will not</strong> help with the process of fitting vital rate models at all! That is a sufficiently different (and vast) question that we decided it was not within the scope of this project. This will only help you turn those regression models into an IPM without shooting yourself in the foot. Thus, everything that follows assumes you have parameterized those vital rate models and are now ready to begin implementing your model.</p>
<p>Below is a brief overview of the package and some examples of how to implement models with it.</p>
</div>
<div id="model-classes" class="section level2">
<h2 class="hasAnchor">
<a href="#model-classes" class="anchor"></a>Model classes</h2>
<p>Once all parameters are estimated, the first step of defining a model in <code>ipmr</code> is to initialize the model using <code><a href="reference/init_ipm.html">init_ipm()</a></code>. This function has two arguments: <code>model_class</code>, and <code>has_age</code>. We will ignore <code>has_age</code> for now, because age-size models are a complicated topic and have their <a href="https://levisc8.github.io/ipmr/articles/age_x_size.html">own vignette</a>.</p>
<p>The <code>model_class</code> defines the basic infrastructure that will be available for subsequent analyses and helps make sure the kernels are correctly implemented from the underlying vital rates. <code>model_class</code> should be a character string with at least 3 (but possibly 4) entries separated by underscores (<code>_</code>). The possible entries for each position are:</p>
<ul>
<li>
<p>Position 1: <code>"simple"</code>/<code>"general"</code></p>
<ul>
<li><p>A. <strong>simple</strong>: This describes an IPM with a single continuous state variable and no discrete stages.</p></li>
<li><p>B. <strong>general</strong>: This describes and IPM with either more than one continuous state variable, one or more discrete stages, or both of the above. Basically, anything other than an IPM with a single continuous state variable.</p></li>
</ul>
</li>
<li>
<p>Position 2: <code>"di"</code>/<code>"dd"</code></p>
<ul>
<li><p>A. <strong>di</strong>: This is used to denote a density-independent IPM.</p></li>
<li><p>B. <strong>dd</strong>: This is used to denote a density-dependent IPM.</p></li>
</ul>
</li>
<li>
<p>Position 3: <code>"det"</code>/<code>"stoch"</code></p>
<ul>
<li><p>A. <strong>det</strong>: This is used to denote a deterministic IPM. If this is used in the third position of <code>model_class</code>, there should not be a fourth entry.</p></li>
<li><p>B. <strong>stoch</strong>: This is used to denote a stochastic IPM. If this is used in the third position of <code>model_class</code>, there should always be a fourth entry. The two possibilities for the fourth are described next.</p></li>
</ul>
</li>
<li>
<p>Position 4: <code>"kern"</code>/<code>"param"</code></p>
<ul>
<li><p>A. <strong>kern</strong>: This describes an IPM with discretely varying parameters such that their values are known before the model is specified. This is usually the case with models that estimate random year/site effects and for which defining a multivariate joint distribution to sample parameters from is not desirable/needed. These models can be a bit more computationally efficient than the <code>param</code> alternative because all kernels can be constructed before the iteration procedure begins, as opposed to requiring reconstruction for every single iteration.</p></li>
<li><p>B. <strong>param</strong>: This describes an IPM with parameters that are re-sampled from some distribution at each iteration of the model (usually a multivariate joint distribution). This can be a multivariate normal defined by covarying slopes and intercepts, or posterior distribution from a Bayesian model. All that is required is that the parameters for the distribution are specified and that the function that generates the parameters at each iteration returns named lists that correspond to the parameter names in the model. Jump down to the <code>"simple_di_stoch_param"</code> example for some inspiration in writing those.</p></li>
</ul>
</li>
</ul>
<p>With the type of model selected, the <code>model_class</code> becomes a string and the call to <code>init_ipm</code> is composed like so: <code><a href="reference/init_ipm.html">init_ipm(model_class = "position1_position_2_position3_position4")</a></code>.</p>
<p>The following possibilities are currently or will become available in <code>ipmr</code> (bold text denotes development progress):</p>
<ul>
<li>Simple, density independent models: <strong>Completed and ready</strong>
</li>
</ul>
<!-- end list --><ol>
<li><p><code>"simple_di_det"</code></p></li>
<li><p><code>"simple_di_stoch_kern"</code></p></li>
<li><p><code>"simple_di_stoch_param"</code></p></li>
</ol>
<!-- end list --><ul>
<li>Simple, density dependent models: <strong>Please be patient</strong>
</li>
</ul>
<!-- end list --><ol>
<li><p><code>"simple_dd_det"</code></p></li>
<li><p><code>"simple_dd_stoch_kern"</code></p></li>
<li><p><code>"simple_dd_stoch_param"</code></p></li>
</ol>
<!-- end list --><ul>
<li>General, density independent models: <strong>Completed and ready</strong>
</li>
</ul>
<!-- end list --><ol>
<li><p><code>"general_di_det"</code></p></li>
<li><p><code>"general_di_stoch_kern"</code></p></li>
<li><p><code>"general_di_stoch_param"</code></p></li>
</ol>
<!-- end list --><ul>
<li>General, density dependent models: <strong>Please be patient</strong>
</li>
</ul>
<!-- end list --><ol>
<li><p><code>"general_dd_det"</code></p></li>
<li><p><code>"general_dd_stoch_kern"</code></p></li>
<li><p><code>"general_dd_stoch_param"</code></p></li>
</ol>
<p>Simple density-independent deterministic, simple kernel-resampled stochastic, and simple parameter resampled stochastic models (<code>simple_di_det</code>, <code>simple_di_stoch_kern</code>, <code>simple_di_stoch_param</code>) are now functional, and are introduced in detail <a href="https://levisc8.github.io/ipmr/articles/ipmr-introduction.html">here</a>. The <code>general_*</code> versions of these are also ready, and an introduction to them is available <a href="https://levisc8.github.io/ipmr/articles/general-ipms.html">here</a>. However, expect changes as more complicated methods are implemented! See below for an example of how to implement an IPM in this framework.</p>
</div>
<div id="examples-for-simple-ipm-classes" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-for-simple-ipm-classes" class="anchor"></a>Examples for simple IPM classes</h2>
<p>Here is a simple model implemented with <code>ipmr</code>. It will use the following set of linear models:</p>
<ol>
<li>
<p>Survival (<code>s</code>): a generalized linear model w/ a logit link.</p>
<ul>
<li>Example model formula: <code><a href="https://rdrr.io/r/stats/glm.html">glm(surv ~ size_1, data = my_surv_data, family = binomial())</a></code>
</li>
</ul>
</li>
<li>
<p>Growth (<code>g</code>): a linear model with a Normal error distribution.</p>
<ul>
<li>Example model formula: <code><a href="https://rdrr.io/r/stats/lm.html">lm(size_2 ~ size_1, data = my_grow_data)</a></code>
</li>
</ul>
</li>
<li>
<p>Pr(flowering) (<code>f_r</code>): a generalized linear model w/ a logit link.</p>
<ul>
<li>Example model formula: <code><a href="https://rdrr.io/r/stats/glm.html">glm(flower ~ size_1, data = my_repro_data, family = binomial())</a></code>
</li>
</ul>
</li>
<li>
<p>Seed production (<code>f_s</code>): a generalized linear model w/ log link.</p>
<ul>
<li>Example model formula: <code><a href="https://rdrr.io/r/stats/glm.html">glm(seeds ~ size_1, data = my_flower_data, family = poisson())</a></code>
</li>
</ul>
</li>
<li><p>Recruit size distribution (<code>f_d</code>): a normal distribution w parameters <code>mu_fd</code> (mean) and <code>sd_fd</code> (standard deviation).</p></li>
</ol>
<p>The example below assumes we’ve already fit our vital rate models from the raw data. In this example, the numbers are made up, but code that extracts the values you need from a real regression model is provided in comments.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co"># Load ipmr and get the parameter values. The data_list argument for define_kernel</span>
<span class="co"># should hold every regression parameter and every constant used in the model.</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ipmr</span>)

<span class="no">data_list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">s_int</span>     <span class="kw">=</span> <span class="fl">2.2</span>,   <span class="co"># coefficients(my_surv_mod)[1]</span>
                 <span class="kw">s_slope</span>   <span class="kw">=</span> <span class="fl">0.25</span>,  <span class="co"># coefficients(my_surv_mod)[2]</span>
                 <span class="kw">g_int</span>     <span class="kw">=</span> <span class="fl">0.2</span>,   <span class="co"># coefficients(my_grow_mod)[1]</span>
                 <span class="kw">g_slope</span>   <span class="kw">=</span> <span class="fl">1.02</span>,  <span class="co"># coefficients(my_grow_mod)[2]</span>
                 <span class="kw">sd_g</span>      <span class="kw">=</span> <span class="fl">0.7</span>,   <span class="co"># sd(resid(my_grow_mod))</span>
                 <span class="kw">f_r_int</span>   <span class="kw">=</span> <span class="fl">0.003</span>, <span class="co"># coefficients(my_pr_flower_mod)[1]</span>
                 <span class="kw">f_r_slope</span> <span class="kw">=</span> <span class="fl">0.015</span>, <span class="co"># coefficients(my_pr_flower_mod)[2]</span>
                 <span class="kw">f_s_int</span>   <span class="kw">=</span> <span class="fl">1.3</span>,   <span class="co"># coefficients(my_seed_mod)[1]</span>
                 <span class="kw">f_s_slope</span> <span class="kw">=</span> <span class="fl">0.075</span>, <span class="co"># coefficients(my_seed_mod)[2]</span>
                 <span class="kw">mu_fd</span>     <span class="kw">=</span> <span class="fl">2</span>,     <span class="co"># mean(recruit_data$size_next)</span>
                 <span class="kw">sd_fd</span>     <span class="kw">=</span> <span class="fl">0.3</span>)   <span class="co"># sd(recruit_data$size_next)</span>

<span class="no">my_simple_ipm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/init_ipm.html">init_ipm</a></span>(<span class="st">'simple_di_det'</span>)


<span class="no">my_simple_ipm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/kernel-definitions.html">define_kernel</a></span>(

  <span class="kw">proto_ipm</span> <span class="kw">=</span> <span class="no">my_simple_ipm</span>,

  <span class="co"># Name of the kernel</span>

  <span class="kw">name</span>      <span class="kw">=</span> <span class="st">"P_simple"</span>,

  <span class="co"># The type of transition it describes (e.g. continuous - continuous, discrete - continuous).</span>
  <span class="co"># These must be specified for all kernels!</span>

  <span class="kw">family</span>    <span class="kw">=</span> <span class="st">"CC"</span>,

  <span class="co"># The formula for the kernel. </span>

  <span class="kw">formula</span>   <span class="kw">=</span> <span class="no">s</span> * <span class="no">g</span>,

  <span class="co"># A named set of expressions for the vital rates it includes. </span>
  <span class="co"># note the use of user-specified functions here. Additionally, each </span>
  <span class="co"># state variable has a stateVariable_1 and stateVariable_2 internally defined</span>
  <span class="co"># for the domain associated with it. Use these to distinguish between </span>
  <span class="co"># size/weight/etc at time t vs size/weight/etc at time t+1</span>

  <span class="co"># Perform the inverse logit transformation to get survival probabilities</span>
  <span class="co"># from your model. For examples on using predict(my_surv_mod,...),</span>
  <span class="co"># see below.</span>

  <span class="kw">s</span>         <span class="kw">=</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-(<span class="no">s_int</span> + <span class="no">s_slope</span> * <span class="no">dbh_1</span>))),

  <span class="co"># The growth model requires a function to compute the mean as a function of dbh.</span>
  <span class="co"># The SD is a constant, so we don't need to define that in ... expression, </span>
  <span class="co"># just the data_list.</span>

  <span class="kw">g</span>         <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="no">dbh_2</span>, <span class="no">mu_g</span>, <span class="no">sd_g</span>),
  <span class="kw">mu_g</span>      <span class="kw">=</span> <span class="no">g_int</span> + <span class="no">g_slope</span> * <span class="no">dbh_1</span>,


  <span class="co"># Specify the constants in the model in the data_list. </span>

  <span class="kw">data_list</span> <span class="kw">=</span> <span class="no">data_list</span>,
  <span class="kw">states</span>    <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'dbh'</span>)),

  <span class="co"># If you want to correct for eviction, set evict_cor = TRUE and specify an</span>
  <span class="co"># evict_fun. ipmr provides truncated_distributions() to help.</span>

  <span class="kw">evict_cor</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">evict_fun</span> <span class="kw">=</span> <span class="fu"><a href="reference/eviction.html">truncated_distributions</a></span>(<span class="st">'norm'</span>,
                                      <span class="st">'g'</span>)
  )

<span class="no">my_simple_ipm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/kernel-definitions.html">define_kernel</a></span>(
  <span class="kw">proto_ipm</span> <span class="kw">=</span> <span class="no">my_simple_ipm</span>,
  <span class="kw">name</span>      <span class="kw">=</span> <span class="st">'F_simple'</span>,
  <span class="kw">formula</span>   <span class="kw">=</span> <span class="no">f_r</span> * <span class="no">f_s</span> * <span class="no">f_d</span>,
  <span class="kw">family</span>    <span class="kw">=</span> <span class="st">'CC'</span>,

  <span class="co"># Inverse logit transformation for flowering probability</span>
  <span class="co"># (because we used a logistic regression)</span>

  <span class="kw">f_r</span>       <span class="kw">=</span> <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>( - (<span class="no">f_r_int</span> + <span class="no">f_r_slope</span> * <span class="no">dbh_1</span>))),

  <span class="co"># Exponential function for seed progression </span>
  <span class="co"># (because we used a Poisson)</span>

  <span class="kw">f_s</span>       <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">f_s_int</span> + <span class="no">f_s_slope</span> * <span class="no">dbh_1</span>),

  <span class="co"># The recruit size distribution has no maternal effect for size,</span>
  <span class="co"># so mu_fd and sd_fd are constants. These get passed in the </span>
  <span class="co"># data_list</span>

  <span class="kw">f_d</span>       <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="no">dbh_2</span>, <span class="no">mu_fd</span>, <span class="no">sd_fd</span>),
  <span class="kw">data_list</span> <span class="kw">=</span> <span class="no">data_list</span>,
  <span class="kw">states</span>    <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'dbh'</span>)),

  <span class="co"># Again, we'll correct for eviction in new recruits by</span>
  <span class="co"># truncating the normal distribution.</span>

  <span class="kw">evict_cor</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">evict_fun</span> <span class="kw">=</span> <span class="fu"><a href="reference/eviction.html">truncated_distributions</a></span>(<span class="st">'norm'</span>,
                                      <span class="st">'f_d'</span>)
)

<span class="no">my_simple_ipm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/kernel-definitions.html">define_k</a></span>(
  <span class="co"># K kernels get their own special define_k function. Rather than use the formula</span>
  <span class="co"># parameter, it simply takes named expressions for the format of the iteration</span>
  <span class="co"># kernels. It can also take expressions showing how these kernels generate </span>
  <span class="co"># population states at t+1 as a function of population state at t - see examples</span>
  <span class="co"># below for how to do that.</span>

  <span class="kw">proto_ipm</span> <span class="kw">=</span> <span class="no">my_simple_ipm</span>,
  <span class="kw">name</span>      <span class="kw">=</span> <span class="st">'K'</span>,
  <span class="kw">K</span>         <span class="kw">=</span> <span class="no">P_simple</span> + <span class="no">F_simple</span>,

  <span class="co"># This is a new family - at the moment all K's will get the</span>
  <span class="co"># 'IPM' family</span>

  <span class="kw">family</span>    <span class="kw">=</span> <span class="st">'IPM'</span>,

  <span class="co"># This kernel has no additional parameters, so the data_list</span>
  <span class="co"># is empty</span>

  <span class="kw">data_list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(),
  <span class="kw">states</span>    <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'dbh'</span>)),
  <span class="co"># We've already corrected eviction in the sub-kernels, so there's no</span>
  <span class="co"># need to do that here</span>
  <span class="kw">evict_cor</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)

<span class="co"># Next, we have to define the implementation details for the model. </span>
  <span class="co"># We need to tell ipmr how each kernel is integrated, what domain</span>
  <span class="co"># it starts on (i.e. the size/weight/etc from above), and what domain</span>
  <span class="co"># it ends on. In simple_* models, dom_start and dom_end will always be the same,</span>
  <span class="co"># because we only have a single continuous state variable. General_*</span>
  <span class="co"># models will be more complicated.</span>

<span class="no">my_simple_ipm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/define_star.html">define_impl</a></span>(
  <span class="kw">proto_ipm</span> <span class="kw">=</span> <span class="no">my_simple_ipm</span>,
  <span class="fu"><a href="reference/define_star.html">make_impl_args_list</a></span>(
    <span class="kw">kernel_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"K_simple"</span>, <span class="st">"P_simple"</span>, <span class="st">"F_simple"</span>),
    <span class="kw">int_rule</span>     <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"midpoint"</span>, <span class="fl">3</span>),
    <span class="kw">dom_start</span>    <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"dbh"</span>, <span class="fl">3</span>),
    <span class="kw">dom_end</span>      <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"dbh"</span>, <span class="fl">3</span>)
  )
)

<span class="no">my_simple_ipm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/define_star.html">define_domains</a></span>(
  <span class="kw">proto_ipm</span> <span class="kw">=</span> <span class="no">my_simple_ipm</span>,
  <span class="kw">dbh</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="co"># the first entry is the lower bound of the domain.</span>
          <span class="fl">50</span>, <span class="co"># the second entry is the upper bound of the domain.</span>
          <span class="fl">100</span> <span class="co"># third entry is the number of meshpoints for the domain.</span>
  )
)

<span class="no">my_simple_ipm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/make_ipm.html">make_ipm</a></span>(<span class="kw">proto_ipm</span> <span class="kw">=</span> <span class="no">my_simple_ipm</span>)


<span class="no">lambda_ipmr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/lambda.html">lambda</a></span>(<span class="no">my_simple_ipm</span>, <span class="kw">comp_method</span> <span class="kw">=</span> <span class="st">'eigen'</span>)
<span class="no">w_ipmr</span>      <span class="kw">&lt;-</span> <span class="fu"><a href="reference/eigenvectors.html">right_ev</a></span>(<span class="no">my_simple_ipm</span>)</pre></div>
<p>If you’re interested in seeing how <code>ipmr</code> output compares to models implemented by hand, there is an article on that <a href="https://levisc8.github.io/ipmr/articles/sanity-checks.html">here</a>.</p>
<p>A more detailed introduction to <code>ipmr</code> is available in the Intro to ipmr article on this page. General IPM (ones with multiple continuous and/or discrete states) tutorials are also available there under the General IPMs article. That’s all for now, happy modelling!</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/levisc8">Sam Levin</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3289-9925" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/levisc8/ipmr"><img src="https://travis-ci.org/levisc8/ipmr.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://ci.appveyor.com/project/levisc8/ipmr"><img src="https://ci.appveyor.com/api/projects/status/github/levisc8/ipmr?branch=master&amp;svg=true" alt="AppVeyor build status"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#maturing"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="Lifecycle: maturing"></a></li>
<li><a href="https://cran.r-project.org/package=ipmr"><img src="https://www.r-pkg.org/badges/version/ipmr" alt="CRAN status"></a></li>
<li><a href="https://codecov.io/gh/levisc8/ipmr?branch=master"><img src="https://codecov.io/gh/levisc8/ipmr/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/levisc8">Sam Levin</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
