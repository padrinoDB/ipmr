<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Integral Projection Models • ipmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Integral Projection Models">
<meta property="og:description" content="Flexibly implements Integral Projection Models using a
  mathematical(ish) syntax. This package will not help with the vital rate
  modeling process, but will help convert those regression models into an
  IPM. ipmr handles density dependence and environmental stochasticity, with a
  couple of options for implementing the latter. In addition, provides functions
  to avoid unintentional eviction of individuals from models. Additionally, 
  provides model diagnostic tools, plotting functionality, 
  stochastic/deterministic simulations, and analysis tools.
  Integral projection models are described in depth by Easterling et al. (2000) 
  &lt;doi:10.1890/0012-9658(2000)081[0694:SSSAAN]2.0.CO;2&gt;, Merow et al. (2013) 
  &lt;doi:10.1111/2041-210X.12146&gt;, Rees et al. (2014) &lt;doi:10.1111/1365-2656.12178&gt;,
  and Metcalf et al. (2015) &lt;doi:10.1111/2041-210X.12405&gt;. 
  Williams et al. (2012) &lt;doi:10.1890/11-2147.1&gt; discuss the problem of 
  unintentional eviction.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ipmr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.6.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/ipmr-introduction.html">Introduction to ipmr</a>
    </li>
    <li>
      <a href="articles/general-ipms.html">General IPMs</a>
    </li>
    <li>
      <a href="articles/index-notation.html">Index Notation in ipmr</a>
    </li>
    <li>
      <a href="articles/age_x_size.html">Age X Size IPMs</a>
    </li>
    <li>
      <a href="articles/density-dependence.html">Density/Frequency Dependent IPMs</a>
    </li>
    <li>
      <a href="articles/proto-ipms.html">proto_ipm Data Structure</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/padrinoDB/ipmr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div class="section level1">
<div class="page-header"><h1 id="ipmr">ipmr<a class="anchor" aria-label="anchor" href="#ipmr"></a>
</h1></div>
<p><code>ipmr</code> is a package for implementing Integral Projection Models (IPMs) in <em>R</em>. It relies heavily on the mathematical syntax of the models, and does not try to abstract over the process of fitting vital rates. It is now relatively stable, though tweaks may be made. The News tab at the top of this page will contain more details on breaking changes as they are introduced to successive versions.</p>
<p>Below is a brief overview of how <code>ipmr</code> classifies different model types followed by examples of how to implement those types in this framework.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ipmr"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version with the snippet below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://remotes.r-lib.org" class="external-link">'remotes'</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"padrinoDB/ipmr"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="package-scope">Package scope<a class="anchor" aria-label="anchor" href="#package-scope"></a>
</h2>
<p><code>ipmr</code> is intended to assist with IPM implementation and analysis. It is important to note that this package <strong>will not</strong> help with the process of fitting regression models for vital rates at all! That is a sufficiently different (and vast) topic that we decided it was not within the scope of this project. This will only help you turn those regression models into an IPM without shooting yourself in the foot. Furthermore, most of the documentation assumes a basic knowledge of IPM theory and construction. For those that are totally new to IPMs, it is strongly recommended to read a theoretical overview of the models first. Some favorites are <a href="https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/0012-9658%282000%29081%5B0694%3ASSSAAN%5D2.0.CO%3B2" class="external-link">Easterling et al. 2000</a>, <a href="https://doi.org/10.1111/2041-210X.12146" class="external-link">Merow et al. 2013</a>, and <a href="https://doi.org/10.1111/1365-2656.12178" class="external-link">Rees et al. 2014</a>. The <a href="https://padrinoDB.github.io/ipmr/articles/ipmr-introduction.html" class="external-link">Introduction to ipmr vignette</a> also contains a brief overview of IPM theory as well as a far more detailed introduction to this package. Thus, everything that follows here assumes you have some basic understanding of IPM theory, parameterized vital rate models, and are now ready to begin implementing your IPM.</p>
</div>
<div class="section level2">
<h2 id="model-classes">Model classes<a class="anchor" aria-label="anchor" href="#model-classes"></a>
</h2>
<p>Once all parameters are estimated, the first step of defining a model in <code>ipmr</code> is to initialize the model using <code><a href="reference/init_ipm.html">init_ipm()</a></code>. This function has five arguments: <code>sim_gen</code>, <code>di_dd</code>, <code>det_stoch</code>, <code>kern_param</code>, and <code>uses_age</code>. We will ignore <code>uses_age</code> for now, because age-size models are less common and have their <a href="https://padrinoDB.github.io/ipmr/articles/age_x_size.html" class="external-link">own vignette</a>.</p>
<p>The combination of these arguments defines the type of IPM, and makes sure that the machinery for subsequent analyses works correctly. The possible entries for each argument are as follows:</p>
<ul>
<li>
<p><code>sim_gen</code>: <code>"simple"</code>/<code>"general"</code></p>
<ul>
<li><p>A. <strong>simple</strong>: This describes an IPM with a single continuous state variable and no discrete stages.</p></li>
<li><p>B. <strong>general</strong>: This describes and IPM with either more than one continuous state variable, one or more discrete stages, or both of the above. Basically, anything other than an IPM with a single continuous state variable.</p></li>
</ul>
</li>
<li>
<p><code>di_dd</code>: <code>"di"</code>/<code>"dd"</code></p>
<ul>
<li><p>A. <strong>di</strong>: This is used to denote a <strong>d</strong>ensity-<strong>i</strong>ndependent IPM.</p></li>
<li><p>B. <strong>dd</strong>: This is used to denote a <strong>d</strong>ensity-<strong>d</strong>ependent IPM.</p></li>
</ul>
</li>
<li>
<p><code>det_stoch</code>: <code>"det"</code>/<code>"stoch"</code></p>
<ul>
<li><p>A. <strong>det</strong>: This is used to denote a deterministic IPM. If this is the third argument of <code>init_ipm</code>, <code>kern_param</code> must be left as <code>NULL</code>.</p></li>
<li><p>B. <strong>stoch</strong>: This is used to denote a stochastic IPM. If this is the third argument of <code>init_ipm</code>, <code>kern_param</code> must be specified. The two possibilities for the fourth are described next.</p></li>
</ul>
</li>
<li>
<p><code>kern_param</code>: <code>"kern"</code>/<code>"param"</code> (Complete definitions found in <a href="https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.12405" class="external-link">Metcalf et al. 2015</a>)</p>
<ul>
<li><p>A. <strong>kern</strong>: This describes an IPM with discretely varying parameters such that their values are known before the model is specified. This is usually the case with models that estimate fixed and/or random year/site effects and for which defining a multivariate joint distribution to sample parameters from is not desirable/needed. These models can be a bit more computationally efficient than the <code>param</code> alternative because all kernels can be constructed before the iteration procedure begins, as opposed to requiring reconstruction for every single iteration.</p></li>
<li><p>B. <strong>param</strong>: This describes an IPM with parameters that are re-sampled from some distribution at each iteration of the model. For example, these could be a multivariate normal defined by covarying slopes and intercepts, or distributions of environmental variables that change from time to time. All that is required is that the parameters for the distribution are specified and that the function that generates the parameters at each iteration returns named lists that correspond to the parameter names in the model. Examples of this are available in the Introduction and General IPM vignettes.</p></li>
</ul>
</li>
</ul>
<p>The following possibilities are currently or will become available in <code>ipmr</code> (bold text denotes development progress):</p>
<ul>
<li>Simple, density independent models: <strong>Completed and ready</strong>
</li>
</ul>
<ol style="list-style-type: decimal">
<li><p><code>"simple_di_det"</code></p></li>
<li><p><code>"simple_di_stoch_kern"</code></p></li>
<li><p><code>"simple_di_stoch_param"</code></p></li>
</ol>
<ul>
<li>Simple, density dependent models: <strong>Completed, likely stable</strong>
</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><p><code>"simple_dd_det"</code></p></li>
<li><p><code>"simple_dd_stoch_kern"</code></p></li>
<li><p><code>"simple_dd_stoch_param"</code></p></li>
</ol>
<ul>
<li>General, density independent models: <strong>Completed and ready</strong>
</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li><p><code>"general_di_det"</code></p></li>
<li><p><code>"general_di_stoch_kern"</code></p></li>
<li><p><code>"general_di_stoch_param"</code></p></li>
</ol>
<ul>
<li>General, density dependent models: <strong>Completed, likely stable</strong>
</li>
</ul>
<ol start="10" style="list-style-type: decimal">
<li><p><code>"general_dd_det"</code></p></li>
<li><p><code>"general_dd_stoch_kern"</code></p></li>
<li><p><code>"general_dd_stoch_param"</code></p></li>
</ol>
<p>Simple density-independent deterministic, simple kernel-resampled stochastic, and simple parameter resampled stochastic models (<code>simple_di_det</code>, <code>simple_di_stoch_kern</code>, <code>simple_di_stoch_param</code>) are described below as well as <a href="https://padrinoDB.github.io/ipmr/articles/ipmr-introduction.html" class="external-link">here</a>. The <code>general_*</code> versions of these are described <a href="https://padrinoDB.github.io/ipmr/articles/general-ipms.html" class="external-link">here</a>. Density dependent versions are completed for simple and general models, and are probably stable, but have not been tested enough to be certain. A very brief (and incomplete) introduction is available <a href="https://padrinoDB.github.io/ipmr/articles/density-dependence.html" class="external-link">here</a>.</p>
<p>Below is an example of how to implement a simple IPM with <code>ipmr</code>.</p>
</div>
<div class="section level2">
<h2 id="examples-for-simple-ipm-classes">Examples for simple IPM classes<a class="anchor" aria-label="anchor" href="#examples-for-simple-ipm-classes"></a>
</h2>
<p>Here is a simple model implemented with <code>ipmr</code>. This is a hypothetical plant species where plants can survive and grow (<em>P</em>(<em>z</em>′,<em>z</em>)), and reproduce sexually (<em>F</em>(<em>z</em>′,<em>z</em>)). There is no seed bank, and so there are no discrete traits in the model. We’ll use 4 regressions: survival (<em>s</em>(<em>z</em>)), growth (<em>G</em>(<em>z</em>′,<em>z</em>), <em>f</em><sub><em>G</em></sub>), probability of reproducing (<em>r</em><sub><em>r</em></sub>(<em>z</em>)), and number of seeds produced conditional on flowering (<em>r</em><sub><em>s</em></sub>(<em>z</em>)). New recruits will be generated with a Gaussian distribution (denoted <em>f</em><sub><em>r</em><sub><em>d</em></sub></sub>), which requires calculating the mean and standard deviation of new recruits from the data. For simplicity, we’ll assume there’s no maternal effect on recruit size. First, we’ll write out the functional forms for each component of the model:</p>
<ol style="list-style-type: decimal">
<li><p><em>n</em>(<em>z</em>′,<em>t</em>+1) = ∫<sub><em>L</em></sub><sup><em>U</em></sup><em>K</em>(<em>z</em>′,<em>z</em>)<em>n</em>(<em>z</em>,<em>t</em>)*d**z*</p></li>
<li><p><em>K</em>(<em>z</em>′,<em>z</em>) = <em>P</em>(<em>z</em>′,<em>z</em>) + <em>F</em>(<em>z</em>′,<em>z</em>)</p></li>
<li><p><em>P</em>(<em>z</em>′,<em>z</em>) = <em>s</em>(<em>z</em>) * <em>G</em>(<em>z</em>′,<em>z</em>)</p></li>
<li><p><em>L<strong>o</strong>g<strong>i</strong>t</em>(<em>s</em>(<em>z</em>)) = <em>α</em><sub><em>s</em></sub> + <em>β</em><sub><em>s</em></sub> * <em>z</em></p></li>
<li><p><em>G</em>(<em>z</em>′,<em>z</em>) = <em>f</em><sub><em>G</em></sub>(<em>μ</em><sub><em>G</em></sub>,<em>σ</em><sub><em>G</em></sub>)</p></li>
<li><p><em>μ</em><sub><em>G</em></sub> = <em>α</em><sub><em>G</em></sub> + <em>β</em><sub><em>G</em></sub> * <em>z</em></p></li>
<li><p><em>F</em>(<em>z</em>′,<em>z</em>) = <em>r</em><sub><em>r</em></sub>(<em>z</em>) * <em>r</em><sub><em>s</em></sub>(<em>z</em>) * <em>r</em><sub><em>d</em></sub>(<em>z</em>′)</p></li>
<li><p><em>L<strong>o</strong>g<strong>i</strong>t</em>(<em>r</em><sub><em>r</em></sub>(<em>z</em>)) = <em>α</em><sub><em>r</em><sub><em>r</em></sub></sub> + <em>β</em><sub><em>r</em><sub><em>r</em></sub></sub> * <em>z</em></p></li>
<li><p><em>L<strong>o</strong>g</em>(<em>r</em><sub><em>s</em></sub>(<em>z</em>)) = <em>α</em><sub><em>r</em><sub><em>s</em></sub></sub> + <em>β</em><sub><em>r</em><sub><em>s</em></sub></sub> * <em>z</em></p></li>
<li><p><em>r</em><sub><em>d</em></sub>(<em>z</em>′) = <em>f</em><sub><em>r</em><sub><em>d</em></sub></sub>(<em>μ</em><sub><em>r</em><sub><em>d</em></sub></sub>,<em>σ</em><sub><em>r</em><sub><em>d</em></sub></sub>)</p></li>
</ol>
<p>Equation 1 describes how all the vital rates act on the initial trait distribution to produce a new one at <em>t</em> + 1. Equations 3-6 describe how existing individuals can survive, and if they survive, grow or shrink. Equations 7-10 describe how existing individuals create new individuals. In order to convert these functions to code, we usually fit regression models to our data. The following set of generalized linear models correspond to the functional forms described above:</p>
<ol style="list-style-type: decimal">
<li>
<p>Survival (<em>s</em>(<em>z</em>) / <code>s</code>): a generalized linear model w/ a logit link.</p>
<ul>
<li>Example model formula: <code>glm(surv ~ size_1, data = my_surv_data, family = binomial())</code>
</li>
</ul>
</li>
<li>
<p>Growth (<em>G</em>(<em>z</em>′,<em>z</em>) / <code>G</code>): a linear model with a normal error distribution.</p>
<ul>
<li>Example model formula: <code>lm(size_2 ~ size_1, data = my_grow_data)</code>
</li>
</ul>
</li>
<li>
<p>Pr(flowering) (<em>r</em><sub><em>r</em></sub>(<em>z</em>) / <code>r_r</code>): a generalized linear model w/ a logit link.</p>
<ul>
<li>Example model formula: <code>glm(flower ~ size_1, data = my_repro_data, family = binomial())</code>
</li>
</ul>
</li>
<li>
<p>Seed production (<em>r</em><sub><em>s</em></sub>(<em>z</em>) / <code>r_s</code>): a generalized linear model w/ log link.</p>
<ul>
<li>Example model formula: <code>glm(seeds ~ size_1, data = my_flower_data, family = poisson())</code>
</li>
</ul>
</li>
<li>
<p>Recruit size distribution (<em>r</em><sub><em>d</em></sub>(<em>z</em>′) / <code>r_d</code>): a normal distribution w parameters <code>mu_rd</code> (mean) and <code>sd_rd</code> (standard deviation).</p>
<ul>
<li>
<p>Example computations:</p>
<ul>
<li><p><code>mu_rd = mean(seedling_data$size_2)</code></p></li>
<li><p><code>sd_rd = sd(seedling_data$size_2)</code></p></li>
</ul>
</li>
</ul>
</li>
</ol>
<p>The example below assumes we’ve already fit our vital rate models from the raw data. In this example, the numbers are made up, but code that extracts the values you need from a real regression model is provided in comments.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load ipmr and get the parameter values. The data_list argument for define_kernel</span></span>
<span><span class="co"># should hold every regression parameter and every constant used in the model.</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://padrinoDB.github.io/ipmr/" class="external-link">ipmr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_data_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>s_int     <span class="op">=</span> <span class="op">-</span><span class="fl">2.2</span>,  <span class="co"># coefficients(my_surv_mod)[1]</span></span>
<span>                    s_slope   <span class="op">=</span> <span class="fl">0.25</span>,  <span class="co"># coefficients(my_surv_mod)[2]</span></span>
<span>                    g_int     <span class="op">=</span> <span class="fl">0.2</span>,   <span class="co"># coefficients(my_grow_mod)[1]</span></span>
<span>                    g_slope   <span class="op">=</span> <span class="fl">0.99</span>,  <span class="co"># coefficients(my_grow_mod)[2]</span></span>
<span>                    sd_g      <span class="op">=</span> <span class="fl">0.7</span>,   <span class="co"># sd(resid(my_grow_mod))</span></span>
<span>                    r_r_int   <span class="op">=</span> <span class="fl">0.003</span>, <span class="co"># coefficients(my_pr_flower_mod)[1]</span></span>
<span>                    r_r_slope <span class="op">=</span> <span class="fl">0.015</span>, <span class="co"># coefficients(my_pr_flower_mod)[2]</span></span>
<span>                    r_s_int   <span class="op">=</span> <span class="fl">0.45</span>,  <span class="co"># coefficients(my_seed_mod)[1]</span></span>
<span>                    r_s_slope <span class="op">=</span> <span class="fl">0.075</span>, <span class="co"># coefficients(my_seed_mod)[2]</span></span>
<span>                    mu_fd     <span class="op">=</span> <span class="fl">2</span>,     <span class="co"># mean(recruit_data$size_next)</span></span>
<span>                    sd_fd     <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>   <span class="co"># sd(recruit_data$size_next)</span></span>
<span></span>
<span><span class="va">my_simple_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/init_ipm.html">init_ipm</a></span><span class="op">(</span>sim_gen <span class="op">=</span> <span class="st">"simple"</span>,</span>
<span>                          di_dd   <span class="op">=</span> <span class="st">"di"</span>,</span>
<span>                          det_stoch <span class="op">=</span> <span class="st">"det"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_simple_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>  </span>
<span>  proto_ipm <span class="op">=</span> <span class="va">my_simple_ipm</span>,</span>
<span>    </span>
<span>  <span class="co"># Name of the kernel</span></span>
<span>  </span>
<span>  name      <span class="op">=</span> <span class="st">"P_simple"</span>,</span>
<span>  </span>
<span>  <span class="co"># The type of transition it describes (e.g. continuous - continuous, discrete - continuous).</span></span>
<span>  <span class="co"># These must be specified for all kernels!</span></span>
<span>  </span>
<span>  family    <span class="op">=</span> <span class="st">"CC"</span>,</span>
<span>  </span>
<span>  <span class="co"># The formula for the kernel. We dont need to tack on the "z'/z"s here.  </span></span>
<span>  </span>
<span>  formula   <span class="op">=</span> <span class="va">s</span> <span class="op">*</span> <span class="va">G</span>,</span>
<span>  </span>
<span>  <span class="co"># A named set of expressions for the vital rates it includes. </span></span>
<span>  <span class="co"># note the use of user-specified functions here. Additionally, each </span></span>
<span>  <span class="co"># state variable has a stateVariable_1 and stateVariable_2, corresponding to</span></span>
<span>  <span class="co"># z and z' in the equations above. We don't need to define these variables ourselves,</span></span>
<span>  <span class="co"># just reference them correctly based on the way we've set up our model on paper.</span></span>
<span>  </span>
<span>  <span class="co"># Perform the inverse logit transformation to get survival probabilities</span></span>
<span>  <span class="co"># from your model. plogis from the "stats" package does this for us. </span></span>
<span></span>
<span>  s         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">s_int</span> <span class="op">+</span> <span class="va">s_slope</span> <span class="op">*</span> <span class="va">dbh_1</span><span class="op">)</span>, </span>
<span>  </span>
<span>  <span class="co"># The growth model requires a function to compute the mean as a function of dbh.</span></span>
<span>  <span class="co"># The SD is a constant, so we don't need to define that in ... expression, </span></span>
<span>  <span class="co"># just the data_list.</span></span>
<span>  </span>
<span>  G         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">dbh_2</span>, <span class="va">mu_g</span>, <span class="va">sd_g</span><span class="op">)</span>,</span>
<span>  mu_g      <span class="op">=</span> <span class="va">g_int</span> <span class="op">+</span> <span class="va">g_slope</span> <span class="op">*</span> <span class="va">dbh_1</span>,</span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># Specify the constant parameters in the model in the data_list. </span></span>
<span>  </span>
<span>  data_list <span class="op">=</span> <span class="va">my_data_list</span>,</span>
<span>  states    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'dbh'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># If you want to correct for eviction, set evict_cor = TRUE and specify an</span></span>
<span>  <span class="co"># evict_fun. ipmr provides truncated_distributions() to help. This function</span></span>
<span>  <span class="co"># takes 2 arguments - the type of distribution, and the name of the parameter/</span></span>
<span>  <span class="co"># vital rate that it acts on.</span></span>
<span>  </span>
<span>  evict_cor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  evict_fun <span class="op">=</span> <span class="fu"><a href="reference/eviction.html">truncated_distributions</a></span><span class="op">(</span>fun    <span class="op">=</span> <span class="st">'norm'</span>,</span>
<span>                                      target <span class="op">=</span> <span class="st">'G'</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">my_simple_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/kernel-definitions.html">define_kernel</a></span><span class="op">(</span></span>
<span>  proto_ipm <span class="op">=</span> <span class="va">my_simple_ipm</span>,</span>
<span>  name      <span class="op">=</span> <span class="st">'F_simple'</span>,</span>
<span>  formula   <span class="op">=</span> <span class="va">r_r</span> <span class="op">*</span> <span class="va">r_s</span> <span class="op">*</span> <span class="va">r_d</span>,</span>
<span>  family    <span class="op">=</span> <span class="st">'CC'</span>,</span>
<span>  </span>
<span>  <span class="co"># Inverse logit transformation for flowering probability</span></span>
<span>  <span class="co"># (because we used a logistic regression)</span></span>
<span>  </span>
<span>  r_r       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">r_r_int</span> <span class="op">+</span> <span class="va">r_r_slope</span> <span class="op">*</span> <span class="va">dbh_1</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Exponential function for seed progression </span></span>
<span>  <span class="co"># (because we used a Poisson)</span></span>
<span>  </span>
<span>  r_s       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">r_s_int</span> <span class="op">+</span> <span class="va">r_s_slope</span> <span class="op">*</span> <span class="va">dbh_1</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># The recruit size distribution has no maternal effect for size,</span></span>
<span>  <span class="co"># so mu_rd and sd_rd are constants. These get passed in the </span></span>
<span>  <span class="co"># data_list</span></span>
<span>  </span>
<span>  r_d       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">dbh_2</span>, <span class="va">mu_rd</span>, <span class="va">sd_rd</span><span class="op">)</span>,</span>
<span>  data_list <span class="op">=</span> <span class="va">my_data_list</span>,</span>
<span>  states    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'dbh'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Again, we'll correct for eviction in new recruits by</span></span>
<span>  <span class="co"># truncating the normal distribution.</span></span>
<span>  </span>
<span>  evict_cor <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  evict_fun <span class="op">=</span> <span class="fu"><a href="reference/eviction.html">truncated_distributions</a></span><span class="op">(</span>fun    <span class="op">=</span> <span class="st">'norm'</span>,</span>
<span>                                      target <span class="op">=</span> <span class="st">'r_d'</span><span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Next, we have to define the implementation details for the model. </span></span>
<span><span class="co"># We need to tell ipmr how each kernel is integrated, what state</span></span>
<span><span class="co"># it starts on (i.e. z from above), and what state</span></span>
<span><span class="co"># it ends on (i.e. z' above). In simple_* models, state_start and state_end will </span></span>
<span><span class="co"># always be the same, because we only have a single continuous state variable. </span></span>
<span><span class="co"># General_* models will be more complicated.</span></span>
<span></span>
<span><span class="va">my_simple_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/define_star.html">define_impl</a></span><span class="op">(</span></span>
<span>  proto_ipm <span class="op">=</span> <span class="va">my_simple_ipm</span>,</span>
<span>  <span class="fu"><a href="reference/define_star.html">make_impl_args_list</a></span><span class="op">(</span></span>
<span>    kernel_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P_simple"</span>, <span class="st">"F_simple"</span><span class="op">)</span>,</span>
<span>    int_rule     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"midpoint"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    state_start  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"dbh"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    state_end    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"dbh"</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="va">my_simple_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/define_star.html">define_domains</a></span><span class="op">(</span></span>
<span>  proto_ipm <span class="op">=</span> <span class="va">my_simple_ipm</span>,</span>
<span>  dbh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="co"># the first entry is the lower bound of the domain.</span></span>
<span>          <span class="fl">50</span>, <span class="co"># the second entry is the upper bound of the domain.</span></span>
<span>          <span class="fl">100</span> <span class="co"># third entry is the number of meshpoints for the domain.</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Next, we define the initial state of the population. We must do this because</span></span>
<span><span class="co"># ipmr computes everything through simulation, and simulations require a </span></span>
<span><span class="co"># population state.</span></span>
<span></span>
<span><span class="va">my_simple_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/define_star.html">define_pop_state</a></span><span class="op">(</span></span>
<span>  proto_ipm <span class="op">=</span> <span class="va">my_simple_ipm</span>,</span>
<span>  n_dbh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_simple_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/make_ipm.html">make_ipm</a></span><span class="op">(</span>proto_ipm <span class="op">=</span> <span class="va">my_simple_ipm</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">lambda_ipmr</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/lambda.html">lambda</a></span><span class="op">(</span><span class="va">my_simple_ipm</span><span class="op">)</span></span>
<span><span class="va">w_ipmr</span>      <span class="op">&lt;-</span> <span class="fu"><a href="reference/eigenvectors.html">right_ev</a></span><span class="op">(</span><span class="va">my_simple_ipm</span><span class="op">)</span></span>
<span><span class="va">v_ipmr</span>      <span class="op">&lt;-</span> <span class="fu"><a href="reference/eigenvectors.html">left_ev</a></span><span class="op">(</span><span class="va">my_simple_ipm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make_ipm_report works on either proto_ipms or made ipm objects</span></span>
<span></span>
<span><span class="fu"><a href="reference/ipm_report.html">make_ipm_report</a></span><span class="op">(</span><span class="va">my_simple_ipm</span>,</span>
<span>                title <span class="op">=</span> <span class="st">"my_ipm_report"</span>,</span>
<span>                render_output <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>A more detailed introduction to <code>ipmr</code> is available in the Intro to ipmr article on this page. General IPM (ones with multiple continuous and/or discrete states) tutorials are also available there under the General IPMs article. Help with age × size models, density dependent models, and the parameter set index syntax are also available there. That’s all for now, happy modeling!</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=ipmr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/padrinoDB/ipmr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/padrinoDB/ipmr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ipmr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/levisc8" class="external-link">Sam Levin</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3289-9925" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Aldo Compagnoni <br><small class="roles"> Author </small>  </li>
<li>Dylan Childs <br><small class="roles"> Author </small>  </li>
<li>Sanne Evers <br><small class="roles"> Author </small>  </li>
<li>Roberto Salguero-Gomez <br><small class="roles"> Author </small>  </li>
<li>Tiffany Knight <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/levisc8" class="external-link">Sam Levin</a>, Aldo Compagnoni, Dylan Childs, Sanne Evers, Roberto Salguero-Gomez, Tiffany Knight.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
