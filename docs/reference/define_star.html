<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Helpers for IPM construction — define_impl • ipmr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Helpers for IPM construction — define_impl"><meta property="og:description" content="Helpers for IPM construction"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipmr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/ipmr-introduction.html">Introduction to ipmr</a>
    </li>
    <li>
      <a href="../articles/general-ipms.html">General IPMs</a>
    </li>
    <li>
      <a href="../articles/index-notation.html">Index Notation in ipmr</a>
    </li>
    <li>
      <a href="../articles/age_x_size.html">Age X Size IPMs</a>
    </li>
    <li>
      <a href="../articles/density-dependence.html">Density/Frequency Dependent IPMs</a>
    </li>
    <li>
      <a href="../articles/proto-ipms.html">proto_ipm Data Structure</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/padrinoDB/ipmr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Helpers for IPM construction</h1>
    <small class="dont-index">Source: <a href="https://github.com/padrinoDB/ipmr/blob/HEAD/R/define_implementation.R" class="external-link"><code>R/define_implementation.R</code></a>, <a href="https://github.com/padrinoDB/ipmr/blob/HEAD/R/utils-dom-states.R" class="external-link"><code>R/utils-dom-states.R</code></a>, <a href="https://github.com/padrinoDB/ipmr/blob/HEAD/R/utils-export.R" class="external-link"><code>R/utils-export.R</code></a></small>
    <div class="hidden name"><code>define_star.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Helpers for IPM construction</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">define_impl</span><span class="op">(</span><span class="va">proto_ipm</span>, <span class="va">kernel_impl_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">make_impl_args_list</span><span class="op">(</span><span class="va">kernel_names</span>, <span class="va">int_rule</span>, <span class="va">state_start</span>, <span class="va">state_end</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">define_domains</span><span class="op">(</span><span class="va">proto_ipm</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">define_pop_state</span><span class="op">(</span><span class="va">proto_ipm</span>, <span class="va">...</span>, pop_vectors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">define_env_state</span><span class="op">(</span><span class="va">proto_ipm</span>, <span class="va">...</span>, data_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">discretize_pop_vector</span><span class="op">(</span></span>
<span>  <span class="va">trait_values</span>,</span>
<span>  <span class="va">n_mesh</span>,</span>
<span>  pad_low <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pad_high <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>proto_ipm</dt>
<dd><p>The name of the model.</p></dd>


<dt>kernel_impl_list</dt>
<dd><p>A named list. Names correspond to kernel names. Each
kernel should have 3 slots defined - the <code>int_rule</code> (integration rule),
the <code>state_start</code> (the domain the kernel begins on), and the <code>state_end</code>
(the domain the kernel ends on). For more complicated models, it is usually
safest to use <code>make_impl_args_list</code> to generate this.</p></dd>


<dt>kernel_names</dt>
<dd><p>A character vector with the names of the kernels
that parameters are being defined for.</p></dd>


<dt>int_rule</dt>
<dd><p>The integration rule to be used for the kernel. The default is
"midpoint". "b2b" (bin to bin) and "cdf" (cumulative density functions) will
be implemented as well.</p></dd>


<dt>state_start</dt>
<dd><p>The name of the state variable for the kernel that the
kernel acts on at time <em>t</em>.</p></dd>


<dt>state_end</dt>
<dd><p>The name of the state variable that the kernel produces
at time <em>t+1</em>.</p></dd>


<dt>...</dt>
<dd><p>Named expressions. See Details for more information on their usage in
each <code>define_*</code> function.</p></dd>


<dt>pop_vectors</dt>
<dd><p>If the population vectors are already pre-defined (i.e. are
not defined by a function passed to <code>...</code>), then they can
be passed as a named list here.</p></dd>


<dt>data_list</dt>
<dd><p>A list of named values that contain data used in the expressions
in <code>...</code> in <code>define_env_state()</code>.</p></dd>


<dt>trait_values</dt>
<dd><p>A numeric vector of trait values.</p></dd>


<dt>n_mesh</dt>
<dd><p>The number of meshpoints to use when integrating the trait
distribution.</p></dd>


<dt>pad_low</dt>
<dd><p>The amount to pad the smallest value by, expressed as a
proportion. For example, 0.8 would shrink the smallest value by 20%.</p></dd>


<dt>pad_high</dt>
<dd><p>The amount to pad the largest value by, expressed as a
proportion. For example, 1.2 would increase the largest value by 20%.</p></dd>


<dt>normalize</dt>
<dd><p>A logical indicating whether to normalize the result to sum
to 1.</p></dd>


<dt>na.rm</dt>
<dd><p>A logical indicating whether to remove <code>NA</code>s from
<code>trait_distrib</code>. If <code>FALSE</code> and <code>trait_values</code> contains
<code>NA</code>s, returns a <code>NA</code> with a warning</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>All <code>define_*</code> functions return a proto_ipm. <code>make_impl_args_list</code></p>


<p>returns a list, and so must be used within a call to <code>define_impl</code> or
before initiating the model creation procedure.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>These are helper functions to define IPMs. They are used after defining the kernels,
but before calling <code><a href="make_ipm.html">make_ipm()</a></code> They are meant to be called in the
following order:</p>
<ol><li><p><code>define_impl()</code></p></li>
<li><p><code>define_domains()</code></p></li>
<li><p><code>define_pop_state()</code></p></li>
<li><p><code>define_env_state()</code></p></li>
</ol><p>The order requirement is so that information is correctly matched to each kernel.
Below are specific details on the way each works.</p>
<p><strong><code>define_impl</code></strong></p>
<p>This has two arguments - <code>proto_ipm</code> (the model object you wish to work with),
and the <code>kernel_impl_list</code>. The format of the <code>kernel_impl_list</code> is:
names of the list should be kernel names, and each kernel should have 3 entries:
<code>int_rule</code>, <code>state_start</code>, and <code>state_end</code>. See examples.</p>
<p><strong><code>define_domains</code></strong></p>
<p>If the <code>int_rule = "midpoint"</code>, the <code>...</code> entries are vectors of
length 3 where the name corresponds to the
state variable, the first entry is the lower bound of the domain, the second
is the upper bound of the domain, and the third entry is the number of
meshpoints. Other <code>int_rule</code>s are not yet implemented, so for now this is the
only format they can take. See examples.</p>
<p><strong><code>define_pop_state</code></strong></p>
<p>This takes either calls to functions in the <code>...</code>, or a pre-generated
list of vectors in the <code>pop_vectors</code>. The names used
for each entry in <code>...</code> and/or for the <code>pop_vectors</code> should be
<code>n_&lt;state_variable&gt;</code>. See examples.</p>
<p><strong><code>define_env_state</code></strong></p>
<p>Takes expressions that generate values for environmental covariates at each
iteration of the model in <code>...</code>. The <code>data_list</code> should contain any
parameters that the function uses, as well as the function itself. The
functions should return named lists. Names in that list can be referenced in
vital rate expressions and/or kernel formulas.</p>
<p><strong><code>discretize_pop_vec</code></strong></p>
<p>This takes a numeric vector of a trait distribution and computes the relative
frequency of trait values. By default, it integrates the kernel density estimate
of the trait using the midpoint rule with <code>n_mesh</code> mesh points.
This is helpful for creating an initial population state vector that
corresponds to an observed trait distribution.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example with kernels named "P" and "F", and a domain "z"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">kernel_impl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>int_rule <span class="op">=</span> <span class="st">"midpoint"</span>,</span></span>
<span class="r-in"><span>                                  state_start <span class="op">=</span> <span class="st">"z"</span>,</span></span>
<span class="r-in"><span>                                  state_end <span class="op">=</span> <span class="st">"z"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>int_rule <span class="op">=</span> <span class="st">"midpoint"</span>,</span></span>
<span class="r-in"><span>                                  state_start <span class="op">=</span> <span class="st">"z"</span>,</span></span>
<span class="r-in"><span>                                  state_end <span class="op">=</span> <span class="st">"z"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># an equivalent version using make_impl_args_list</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">kernel_impl_list</span> <span class="op">&lt;-</span> <span class="fu">make_impl_args_list</span><span class="op">(</span></span></span>
<span class="r-in"><span>     kernel_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="st">"F"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     int_rule     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"midpoint"</span>, <span class="st">"midpoint"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     state_start  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="st">"z"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     state_end    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z"</span>, <span class="st">"z"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sim_di_det_ex</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">proto_ipm</span> <span class="op">&lt;-</span> <span class="va">sim_di_det_ex</span><span class="op">$</span><span class="va">proto_ipm</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define_domains</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">lower_bound</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">upper_bound</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">n_meshpoints</span> <span class="op">&lt;-</span> <span class="fl">50</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">define_domains</span><span class="op">(</span><span class="va">proto_ipm</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lower_bound</span>, <span class="va">upper_bound</span>, <span class="va">n_meshpoints</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A simple, density independent, deterministic proto_ipm with 2 kernels defined:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  P, F </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel formulae:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> P: s * g</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F: f_r * f_s * f_d</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Vital rates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s: inv_logit(s_int, s_slope, dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g: dnorm(dbh_2, mu_g, sd_g)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu_g: g_int + g_slope * dbh_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_r: inv_logit(f_r_int, f_r_slope, dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_s: exp(f_s_int + f_s_slope * dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_d: dnorm(dbh_2, mu_fd, sd_fd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameter names:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "s_int"     "s_slope"   "g_int"     "g_slope"   "sd_g"      "f_r_int"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "f_r_slope" "f_s_int"   "f_s_slope" "mu_fd"     "sd_fd"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All parameters in vital rate expressions found in 'data_list':  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Domains for state variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dbh: lower_bound = 1, upper_bound = 100, n_meshpoints = 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Population states defined:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n_dbh: runif(100)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Internally generated model iteration procedure:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n_dbh_t_1: right_mult(kernel = P, vectr = n_dbh_t) + right_mult(kernel = F, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vectr = n_dbh_t)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define_pop_state with a state variable named "z". Note that "n_" is prefixed</span></span></span>
<span class="r-in"><span><span class="co"># to denote that it is a population state function!</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">define_pop_state</span><span class="op">(</span><span class="va">proto_ipm</span>, n_z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A simple, density independent, deterministic proto_ipm with 2 kernels defined:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  P, F </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel formulae:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> P: s * g</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F: f_r * f_s * f_d</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Vital rates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s: inv_logit(s_int, s_slope, dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g: dnorm(dbh_2, mu_g, sd_g)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu_g: g_int + g_slope * dbh_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_r: inv_logit(f_r_int, f_r_slope, dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_s: exp(f_s_int + f_s_slope * dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_d: dnorm(dbh_2, mu_fd, sd_fd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameter names:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "s_int"     "s_slope"   "g_int"     "g_slope"   "sd_g"      "f_r_int"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "f_r_slope" "f_s_int"   "f_s_slope" "mu_fd"     "sd_fd"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All parameters in vital rate expressions found in 'data_list':  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Domains for state variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dbh: lower_bound = 0, upper_bound = 50, n_meshpoints = 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Population states defined:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n_z: runif(100)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Internally generated model iteration procedure:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n_dbh_t_1: right_mult(kernel = P, vectr = n_dbh_t) + right_mult(kernel = F, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vectr = n_dbh_t)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># alternative, we can make a list before starting to make the IPM</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pop_vecs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">define_pop_state</span><span class="op">(</span><span class="va">proto_ipm</span>, pop_vectors <span class="op">=</span> <span class="va">pop_vecs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A simple, density independent, deterministic proto_ipm with 2 kernels defined:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  P, F </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel formulae:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> P: s * g</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F: f_r * f_s * f_d</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Vital rates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s: inv_logit(s_int, s_slope, dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g: dnorm(dbh_2, mu_g, sd_g)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu_g: g_int + g_slope * dbh_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_r: inv_logit(f_r_int, f_r_slope, dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_s: exp(f_s_int + f_s_slope * dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_d: dnorm(dbh_2, mu_fd, sd_fd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameter names:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "s_int"     "s_slope"   "g_int"     "g_slope"   "sd_g"      "f_r_int"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "f_r_slope" "f_s_int"   "f_s_slope" "mu_fd"     "sd_fd"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All parameters in vital rate expressions found in 'data_list':  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Domains for state variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dbh: lower_bound = 0, upper_bound = 50, n_meshpoints = 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Population states defined:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n_z: Pre-defined population state.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Internally generated model iteration procedure:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n_dbh_t_1: right_mult(kernel = P, vectr = n_dbh_t) + right_mult(kernel = F, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vectr = n_dbh_t)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define_env_state. Generates a random draw from a known distribution</span></span></span>
<span class="r-in"><span><span class="co"># of temperatures.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">env_sampler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">env_pars</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">env_pars</span><span class="op">$</span><span class="va">temp_mean</span>, <span class="va">env_pars</span><span class="op">$</span><span class="va">temp_sd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="va">temp</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">env_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temp_mean <span class="op">=</span> <span class="fl">12</span>, temp_sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">define_env_state</span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="va">proto_ipm</span>,</span></span>
<span class="r-in"><span> env_values <span class="op">=</span> <span class="fu">env_sampler</span><span class="op">(</span><span class="va">env_pars</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> data_list  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>env_sampler <span class="op">=</span> <span class="va">env_sampler</span>,</span></span>
<span class="r-in"><span>                   env_pars    <span class="op">=</span> <span class="va">env_pars</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A simple, density independent, deterministic proto_ipm with 2 kernels defined:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  P, F </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kernel formulae:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> P: s * g</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F: f_r * f_s * f_d</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Vital rates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s: inv_logit(s_int, s_slope, dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g: dnorm(dbh_2, mu_g, sd_g)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu_g: g_int + g_slope * dbh_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_r: inv_logit(f_r_int, f_r_slope, dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_s: exp(f_s_int + f_s_slope * dbh_1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_d: dnorm(dbh_2, mu_fd, sd_fd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameter names:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "s_int"     "s_slope"   "g_int"     "g_slope"   "sd_g"      "f_r_int"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "f_r_slope" "f_s_int"   "f_s_slope" "mu_fd"     "sd_fd"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All parameters in vital rate expressions found in 'data_list':  TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Domains for state variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dbh: lower_bound = 0, upper_bound = 50, n_meshpoints = 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Population states defined:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n_dbh: runif(100)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Internally generated model iteration procedure:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n_dbh_t_1: right_mult(kernel = P, vectr = n_dbh_t) + right_mult(kernel = F, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     vectr = n_dbh_t)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iceplant_ex</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">iceplant_ex</span><span class="op">$</span><span class="va">log_size</span>, <span class="va">iceplant_ex</span><span class="op">$</span><span class="va">log_size_next</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pop_vecs</span> <span class="op">&lt;-</span> <span class="fu">discretize_pop_vector</span><span class="op">(</span><span class="va">z</span>,</span></span>
<span class="r-in"><span>                                  n_mesh <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                                  pad_low <span class="op">=</span> <span class="fl">1.2</span>,</span></span>
<span class="r-in"><span>                                  pad_high <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://github.com/levisc8" class="external-link">Sam Levin</a>, Aldo Compagnoni, Dylan Childs, Sanne Evers, Roberto Salguero-Gomez, Tiffany Knight.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

