<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fits IPMs using an expression based framework  • ipmr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Fits IPMs using an expression based framework ">
<meta property="og:description" content="Flexibly implements IPMs using an expression based framework. This
  will not abstract away the model selection process, but it will make sure you
  get everything after that correct. It handles density dependence and environmental
  stochasticity, with a couple of options for implementing the latter. Additionally,
  provides model diagnostic tools, plotting functionality, stochastic/deterministic
  simulations, and analysis tools.">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ipmr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/hierarchical-notation.html">Hierarchical Notation</a>
    </li>
    <li>
      <a href="articles/ipmr-introduction.html">Introduction to ipmr</a>
    </li>
    <li>
      <a href="articles/proto-ipms.html">proto_ipm data structure</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    

<div id="ipmr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#ipmr" class="anchor"></a>ipmr</h1></div>
<p>Simple density-independent deterministic, simple kernel-resampled stochastic, and simple parameter resampled stochastic models (<code>simple_di_det</code>, <code>simple_di_stoch_kern</code>, <code>simple_di_stoch_param</code>) are now functional. However, expect changes as more complicated methods are implemented! See below for an example of how to implement an IPM in this framework.</p>
<p>Next on the implementation to-do list are the general versions of these (still density independent).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Example of the setup for a simple IPM without density dependence or environmental</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># stochasticity</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ipmr)</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">data_list &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">s_int =</span> <span class="fl">2.2</span>,</a>
<a class="sourceLine" id="cb1-7" title="7">                  <span class="dt">s_slope =</span> <span class="fl">0.25</span>,</a>
<a class="sourceLine" id="cb1-8" title="8">                  <span class="dt">g_int =</span> <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb1-9" title="9">                  <span class="dt">g_slope =</span> <span class="fl">1.02</span>,</a>
<a class="sourceLine" id="cb1-10" title="10">                  <span class="dt">sd_g =</span> <span class="fl">0.7</span>,</a>
<a class="sourceLine" id="cb1-11" title="11">                  <span class="dt">f_r_int =</span> <span class="fl">0.03</span>,</a>
<a class="sourceLine" id="cb1-12" title="12">                  <span class="dt">f_r_slope =</span> <span class="fl">0.015</span>,</a>
<a class="sourceLine" id="cb1-13" title="13">                  <span class="dt">f_s_int =</span> <span class="fl">1.3</span>,</a>
<a class="sourceLine" id="cb1-14" title="14">                  <span class="dt">f_s_slope =</span> <span class="fl">0.075</span>,</a>
<a class="sourceLine" id="cb1-15" title="15">                  <span class="dt">mu_fd =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb1-16" title="16">                  <span class="dt">sd_fd =</span> <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18">s &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, params) {</a>
<a class="sourceLine" id="cb1-19" title="19">  <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>(params[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>params[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>sv1)))</a>
<a class="sourceLine" id="cb1-20" title="20">}</a>
<a class="sourceLine" id="cb1-21" title="21"></a>
<a class="sourceLine" id="cb1-22" title="22"></a>
<a class="sourceLine" id="cb1-23" title="23">g &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, sv2, params) {</a>
<a class="sourceLine" id="cb1-24" title="24">  mu &lt;-<span class="st"> </span>params[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>params[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>sv1</a>
<a class="sourceLine" id="cb1-25" title="25">  <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(sv2, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> params[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb1-26" title="26">}</a>
<a class="sourceLine" id="cb1-27" title="27"></a>
<a class="sourceLine" id="cb1-28" title="28">f_r &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, params) {</a>
<a class="sourceLine" id="cb1-29" title="29">  <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>(params[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>params[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>sv1)))</a>
<a class="sourceLine" id="cb1-30" title="30">}</a>
<a class="sourceLine" id="cb1-31" title="31"></a>
<a class="sourceLine" id="cb1-32" title="32">f_s &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, params) {</a>
<a class="sourceLine" id="cb1-33" title="33">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(params[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>params[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>sv1)</a>
<a class="sourceLine" id="cb1-34" title="34">}</a>
<a class="sourceLine" id="cb1-35" title="35"></a>
<a class="sourceLine" id="cb1-36" title="36">f_d &lt;-<span class="st"> </span><span class="cf">function</span>(sv2, params) {</a>
<a class="sourceLine" id="cb1-37" title="37">  <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(sv2, <span class="dt">mean =</span> params[<span class="dv">1</span>], <span class="dt">sd =</span> params[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb1-38" title="38">}</a>
<a class="sourceLine" id="cb1-39" title="39"></a>
<a class="sourceLine" id="cb1-40" title="40">fec &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, sv2, params) {</a>
<a class="sourceLine" id="cb1-41" title="41">  <span class="kw">f_r</span>(sv1, params[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">f_s</span>(sv1, params[<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">f_d</span>(sv2, params[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>])</a>
<a class="sourceLine" id="cb1-42" title="42">}</a>
<a class="sourceLine" id="cb1-43" title="43"></a>
<a class="sourceLine" id="cb1-44" title="44">b  &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dt">length.out =</span> <span class="dv">101</span>)</a>
<a class="sourceLine" id="cb1-45" title="45">d1 &lt;-<span class="st"> </span>d2 &lt;-<span class="st"> </span>(b[<span class="dv">2</span><span class="op">:</span><span class="dv">101</span>] <span class="op">+</span><span class="st"> </span>b[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>]) <span class="op">*</span><span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb1-46" title="46">h  &lt;-<span class="st"> </span>d1[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>d1[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb1-47" title="47"></a>
<a class="sourceLine" id="cb1-48" title="48"></a>
<a class="sourceLine" id="cb1-49" title="49">G  &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(d1, d2, <span class="dt">FUN =</span> g, <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(data_list<span class="op">$</span>g_int,</a>
<a class="sourceLine" id="cb1-50" title="50">                                        data_list<span class="op">$</span>g_slope,</a>
<a class="sourceLine" id="cb1-51" title="51">                                        data_list<span class="op">$</span>sd_g))</a>
<a class="sourceLine" id="cb1-52" title="52">G2 &lt;-<span class="st"> </span>G<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(G, <span class="dv">2</span>, sum)),</a>
<a class="sourceLine" id="cb1-53" title="53">               <span class="dt">nrow =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(d1),</a>
<a class="sourceLine" id="cb1-54" title="54">               <span class="dt">ncol =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(d1),</a>
<a class="sourceLine" id="cb1-55" title="55">               <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-56" title="56"></a>
<a class="sourceLine" id="cb1-57" title="57">S  &lt;-<span class="st"> </span><span class="kw">s</span>(d1, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(data_list<span class="op">$</span>s_int, data_list<span class="op">$</span>s_slope))</a>
<a class="sourceLine" id="cb1-58" title="58"></a>
<a class="sourceLine" id="cb1-59" title="59">P  &lt;-<span class="st"> </span>h <span class="op">*</span><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(S <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(G2))</a>
<a class="sourceLine" id="cb1-60" title="60"></a>
<a class="sourceLine" id="cb1-61" title="61">Fm &lt;-<span class="st"> </span>h <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(d1, d2, <span class="dt">FUN =</span> fec, <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(data_list[<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>]))</a>
<a class="sourceLine" id="cb1-62" title="62"></a>
<a class="sourceLine" id="cb1-63" title="63">K &lt;-<span class="st"> </span>P <span class="op">+</span><span class="st"> </span>Fm</a>
<a class="sourceLine" id="cb1-64" title="64"></a>
<a class="sourceLine" id="cb1-65" title="65">lambda_usr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(K)<span class="op">$</span>values[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1-66" title="66">w_usr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(K)<span class="op">$</span>vectors[ , <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1-67" title="67"></a>
<a class="sourceLine" id="cb1-68" title="68"></a>
<a class="sourceLine" id="cb1-69" title="69"><span class="co"># User specified functions can be passed to make_ipm(usr_funs = list(my_fun = my_fun)).</span></a>
<a class="sourceLine" id="cb1-70" title="70"><span class="co"># inv_logit is a simple example, but more complicated ones can be specified as well. </span></a>
<a class="sourceLine" id="cb1-71" title="71"></a>
<a class="sourceLine" id="cb1-72" title="72">inv_logit &lt;-<span class="st"> </span><span class="cf">function</span>(int, slope, sv) {</a>
<a class="sourceLine" id="cb1-73" title="73">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>(int <span class="op">+</span><span class="st"> </span>slope <span class="op">*</span><span class="st"> </span>sv))))</a>
<a class="sourceLine" id="cb1-74" title="74">}</a>
<a class="sourceLine" id="cb1-75" title="75"></a>
<a class="sourceLine" id="cb1-76" title="76">state_list &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'dbh'</span>))</a>
<a class="sourceLine" id="cb1-77" title="77"></a>
<a class="sourceLine" id="cb1-78" title="78">x &lt;-<span class="st"> </span><span class="kw"><a href="reference/init_ipm.html">init_ipm</a></span>(<span class="st">'simple_di_det'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-79" title="79"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb1-80" title="80">    <span class="co"># Name of the kernel</span></a>
<a class="sourceLine" id="cb1-81" title="81">    <span class="dt">name =</span> <span class="st">"P"</span>,</a>
<a class="sourceLine" id="cb1-82" title="82">    <span class="co"># The type of transition it describes (e.g. continuous - continuous, discrete - continuous)</span></a>
<a class="sourceLine" id="cb1-83" title="83">    <span class="dt">family =</span> <span class="st">"CC"</span>,</a>
<a class="sourceLine" id="cb1-84" title="84">    <span class="co"># The formula for the kernel. s_g_mult() is a helper function to make sure the</span></a>
<a class="sourceLine" id="cb1-85" title="85">    <span class="co"># survival vector is correctly aligned with the kernel.</span></a>
<a class="sourceLine" id="cb1-86" title="86">    <span class="dt">formula =</span> <span class="kw"><a href="reference/fun-mult-helpers.html">s_g_mult</a></span>(s, g),</a>
<a class="sourceLine" id="cb1-87" title="87">    <span class="co"># A named set of expressions for the vital rates it includes. </span></a>
<a class="sourceLine" id="cb1-88" title="88">    </a>
<a class="sourceLine" id="cb1-89" title="89">    <span class="dt">s =</span> <span class="kw">inv_logit</span>(s_int, s_slope, dbh_<span class="dv">1</span>), <span class="co"># note the use of user-specified function here</span></a>
<a class="sourceLine" id="cb1-90" title="90">    <span class="dt">g =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(dbh_<span class="dv">2</span>, mu_g, sd_g),</a>
<a class="sourceLine" id="cb1-91" title="91">    <span class="dt">mu_g =</span> g_int <span class="op">+</span><span class="st"> </span>g_slope <span class="op">*</span><span class="st"> </span>dbh_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1-92" title="92">    <span class="dt">data_list =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">s_int =</span> <span class="fl">2.2</span>,</a>
<a class="sourceLine" id="cb1-93" title="93">                     <span class="dt">s_slope =</span> <span class="fl">0.25</span>,</a>
<a class="sourceLine" id="cb1-94" title="94">                     <span class="dt">g_int =</span> <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb1-95" title="95">                     <span class="dt">g_slope =</span> <span class="fl">1.02</span>,</a>
<a class="sourceLine" id="cb1-96" title="96">                     <span class="dt">sd_g =</span> <span class="fl">0.7</span>),</a>
<a class="sourceLine" id="cb1-97" title="97">    <span class="dt">states =</span> state_list,</a>
<a class="sourceLine" id="cb1-98" title="98">    <span class="dt">has_hier_effs =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb1-99" title="99">    <span class="co"># The evict_fun argument can take any function. ipmr provides built in</span></a>
<a class="sourceLine" id="cb1-100" title="100">    <span class="co"># truncated density functions, but a user specified one will work as well, </span></a>
<a class="sourceLine" id="cb1-101" title="101">    <span class="co"># provided all parameters are provided in the data_list argument.</span></a>
<a class="sourceLine" id="cb1-102" title="102">    <span class="dt">evict =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1-103" title="103">    <span class="dt">evict_fun =</span> <span class="kw"><a href="reference/eviction.html">truncated_distributions</a></span>(g,</a>
<a class="sourceLine" id="cb1-104" title="104">                                        <span class="dt">n_mesh_p =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-105" title="105"><span class="st">  </span></a>
<a class="sourceLine" id="cb1-106" title="106"><span class="st">  </span><span class="co"># Define the fecundity kernel</span></a>
<a class="sourceLine" id="cb1-107" title="107"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb1-108" title="108">    <span class="dt">name =</span> <span class="st">'F'</span>,</a>
<a class="sourceLine" id="cb1-109" title="109">    <span class="dt">formula =</span> f_r <span class="op">*</span><span class="st"> </span>f_s <span class="op">*</span><span class="st"> </span>f_d,</a>
<a class="sourceLine" id="cb1-110" title="110">    <span class="dt">family =</span> <span class="st">'CC'</span>,</a>
<a class="sourceLine" id="cb1-111" title="111">    <span class="dt">f_r =</span> <span class="kw">inv_logit</span>(f_r_int, f_r_slope, dbh_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-112" title="112">    <span class="dt">f_s =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(f_s_int <span class="op">+</span><span class="st"> </span>f_s_slope <span class="op">*</span><span class="st"> </span>dbh_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1-113" title="113">    <span class="dt">f_d =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(dbh_<span class="dv">2</span>, mu_fd, sd_fd),</a>
<a class="sourceLine" id="cb1-114" title="114">    <span class="dt">data_list =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">f_r_int =</span> <span class="fl">0.03</span>,</a>
<a class="sourceLine" id="cb1-115" title="115">                     <span class="dt">f_r_slope =</span> <span class="fl">0.015</span>,</a>
<a class="sourceLine" id="cb1-116" title="116">                     <span class="dt">f_s_int =</span> <span class="fl">1.3</span>,</a>
<a class="sourceLine" id="cb1-117" title="117">                     <span class="dt">f_s_slope =</span> <span class="fl">0.075</span>,</a>
<a class="sourceLine" id="cb1-118" title="118">                     <span class="dt">mu_fd =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb1-119" title="119">                     <span class="dt">sd_fd =</span> <span class="fl">0.2</span>),</a>
<a class="sourceLine" id="cb1-120" title="120">    <span class="dt">states =</span> state_list,</a>
<a class="sourceLine" id="cb1-121" title="121">    <span class="dt">evict =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb1-122" title="122">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-123" title="123"><span class="st">  </span><span class="co"># K kernels get their own special define_k function. Rather than use the formula</span></a>
<a class="sourceLine" id="cb1-124" title="124"><span class="st">  </span><span class="co"># parameter, it simply takes ..., allowing you to specify the form of the iteration</span></a>
<a class="sourceLine" id="cb1-125" title="125"><span class="st">  </span><span class="co"># kernel and the population vector at T + 1 simulataneously. This is likely to</span></a>
<a class="sourceLine" id="cb1-126" title="126"><span class="st">  </span><span class="co"># be more useful for stochastic simulation models than deterministic models</span></a>
<a class="sourceLine" id="cb1-127" title="127"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_k</a></span>(</a>
<a class="sourceLine" id="cb1-128" title="128">    <span class="dt">name =</span> <span class="st">"K"</span>,</a>
<a class="sourceLine" id="cb1-129" title="129">    <span class="dt">K =</span> P <span class="op">+</span><span class="st"> </span>F,</a>
<a class="sourceLine" id="cb1-130" title="130">    <span class="dt">family =</span> <span class="st">"IPM"</span>,</a>
<a class="sourceLine" id="cb1-131" title="131">    <span class="dt">states =</span> state_list,</a>
<a class="sourceLine" id="cb1-132" title="132">    <span class="dt">evict =</span> <span class="ot">FALSE</span> <span class="co"># this is dealt with in the sub-kernels, so no need to do so again.</span></a>
<a class="sourceLine" id="cb1-133" title="133">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-134" title="134"><span class="st">  </span><span class="kw"><a href="reference/impl-args.html">define_impl</a></span>(</a>
<a class="sourceLine" id="cb1-135" title="135">    <span class="dt">kernel_impl_list =</span>  <span class="kw"><a href="reference/impl-args.html">make_impl_args_list</a></span>(</a>
<a class="sourceLine" id="cb1-136" title="136">      <span class="dt">kernel_names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"K"</span>, <span class="st">"P"</span>, <span class="st">"F"</span>),</a>
<a class="sourceLine" id="cb1-137" title="137">      <span class="dt">int_rule =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">'midpoint'</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1-138" title="138">      <span class="dt">dom_start =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">'dbh'</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1-139" title="139">      <span class="dt">dom_end =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">'dbh'</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb1-140" title="140">    )</a>
<a class="sourceLine" id="cb1-141" title="141">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-142" title="142"><span class="st">  </span><span class="kw"><a href="reference/doms-n-states.html">define_domains</a></span>(</a>
<a class="sourceLine" id="cb1-143" title="143">    <span class="dt">dbh =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="co"># the first entry is the lower bound of the domain.</span></a>
<a class="sourceLine" id="cb1-144" title="144">            <span class="dv">50</span>, <span class="co"># the second entry is the upper bound of the domain.</span></a>
<a class="sourceLine" id="cb1-145" title="145">            <span class="dv">100</span> <span class="co"># third entry is the number of meshpoints for the domain.</span></a>
<a class="sourceLine" id="cb1-146" title="146">    )</a>
<a class="sourceLine" id="cb1-147" title="147">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-148" title="148"><span class="st">  </span><span class="kw"><a href="reference/make_ipm.html">make_ipm</a></span>(<span class="dt">usr_funs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">inv_logit =</span> inv_logit))</a>
<a class="sourceLine" id="cb1-149" title="149"></a>
<a class="sourceLine" id="cb1-150" title="150">lambda_ipmr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(x<span class="op">$</span>iterators<span class="op">$</span>K)<span class="op">$</span>values[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1-151" title="151">w_ipmr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(x<span class="op">$</span>iterators<span class="op">$</span>K)<span class="op">$</span>vectors[ , <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1-152" title="152"></a>
<a class="sourceLine" id="cb1-153" title="153">lambda_ipmr <span class="op">-</span><span class="st"> </span>lambda_usr</a></code></pre></div>
<div id="simple-density-independent-stochastic-kernel-resampled-models" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-density-independent-stochastic-kernel-resampled-models" class="anchor"></a>Simple, density independent, stochastic kernel resampled models</h2>
<p>These models are typically the result of vital rate models that are fit in a mixed effects framework (e.g. multiple sites or multiple years of data). They have a special syntax that mirrors the mathematical notation of these models (and has the side effect of saving you a considerable amount of copying/pasting/typing in general).</p>
<p>The syntax uses a <code>name_hierarchicalVariable</code> notation. These names are automatically expanded to include the multiple levels of the hierarchical variable. For example, the P kernel for a model with 5 years of data could be <code>name</code>’d <code>P_yr</code>, and the underlying vital rates would be denoted <code>vitalRate_yr</code>. The parameter values in the <code>data_list</code> are the exception to this - they must be labeled with the actual values that the hierarchical variable takes.</p>
<p>The example below simulates a lifecycle where reproduction is always fatal. Thus, the survival term also includes the probability of reproducing. This is meant to (hopefully) demonstrate the flexibility of the framework.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># rlang is a useful shortcut for splicing named values into lists. purrr is used to manipulate said lists.</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co"># This is intended to simulate a monocarpic perennial life history where flowering is always fatal.</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co"># Note that this means the survival function also includes the probability of reproduction function.</span></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rlang)</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ipmr)</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co"># define functions for target ipm</span></a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co"># Survival - logistic regression</span></a>
<a class="sourceLine" id="cb2-12" title="12">s &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, params, r_effect) {</a>
<a class="sourceLine" id="cb2-13" title="13">  <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>(params[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>params[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>sv1 <span class="op">+</span><span class="st"> </span>r_effect))) <span class="op">*</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="st">    </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">f_r</span>(sv1, params[<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>]))</a>
<a class="sourceLine" id="cb2-15" title="15">}</a>
<a class="sourceLine" id="cb2-16" title="16"></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co"># Growth</span></a>
<a class="sourceLine" id="cb2-18" title="18">g &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, sv2, params, r_effect) {</a>
<a class="sourceLine" id="cb2-19" title="19">  mu &lt;-<span class="st"> </span>params[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>params[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>sv1 <span class="op">+</span><span class="st"> </span>r_effect</a>
<a class="sourceLine" id="cb2-20" title="20">  <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(sv2, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> params[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb2-21" title="21">}</a>
<a class="sourceLine" id="cb2-22" title="22"></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co"># probability of reproducing</span></a>
<a class="sourceLine" id="cb2-24" title="24">f_r &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, params) {</a>
<a class="sourceLine" id="cb2-25" title="25">  <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>(params[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>params[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>sv1)))</a>
<a class="sourceLine" id="cb2-26" title="26">}</a>
<a class="sourceLine" id="cb2-27" title="27"></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co"># offspring production</span></a>
<a class="sourceLine" id="cb2-29" title="29">f_s &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, params, r_effect) {</a>
<a class="sourceLine" id="cb2-30" title="30">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(params[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>params[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>sv1 <span class="op">+</span><span class="st"> </span>r_effect)</a>
<a class="sourceLine" id="cb2-31" title="31">}</a>
<a class="sourceLine" id="cb2-32" title="32"></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="co"># offspring size distribution</span></a>
<a class="sourceLine" id="cb2-34" title="34">f_d &lt;-<span class="st"> </span><span class="cf">function</span>(sv2, params) {</a>
<a class="sourceLine" id="cb2-35" title="35">  <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(sv2, <span class="dt">mean =</span> params[<span class="dv">1</span>], <span class="dt">sd =</span> params[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb2-36" title="36">}</a>
<a class="sourceLine" id="cb2-37" title="37"></a>
<a class="sourceLine" id="cb2-38" title="38"><span class="co"># constructor function for the F kernel</span></a>
<a class="sourceLine" id="cb2-39" title="39">fec &lt;-<span class="st"> </span><span class="cf">function</span>(sv1, sv2, params, r_effect) {</a>
<a class="sourceLine" id="cb2-40" title="40">  <span class="kw">f_r</span>(sv1, params[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">f_s</span>(sv1, params[<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>], r_effect) <span class="op">*</span><span class="st"> </span><span class="kw">f_d</span>(sv2, params[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>])</a>
<a class="sourceLine" id="cb2-41" title="41">}</a>
<a class="sourceLine" id="cb2-42" title="42"></a>
<a class="sourceLine" id="cb2-43" title="43"></a>
<a class="sourceLine" id="cb2-44" title="44"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">50127</span>)</a>
<a class="sourceLine" id="cb2-45" title="45"></a>
<a class="sourceLine" id="cb2-46" title="46"></a>
<a class="sourceLine" id="cb2-47" title="47"><span class="co"># Define some fixed parameters</span></a>
<a class="sourceLine" id="cb2-48" title="48">data_list =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">s_int =</span> <span class="fl">1.03</span>,</a>
<a class="sourceLine" id="cb2-49" title="49">                 <span class="dt">s_slope =</span> <span class="fl">2.2</span>,</a>
<a class="sourceLine" id="cb2-50" title="50">                 <span class="dt">g_int =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb2-51" title="51">                 <span class="dt">g_slope =</span> <span class="fl">0.92</span>,</a>
<a class="sourceLine" id="cb2-52" title="52">                 <span class="dt">sd_g =</span> <span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb2-53" title="53">                 <span class="dt">f_r_int =</span> <span class="fl">0.09</span>,</a>
<a class="sourceLine" id="cb2-54" title="54">                 <span class="dt">f_r_slope =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb2-55" title="55">                 <span class="dt">f_s_int =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb2-56" title="56">                 <span class="dt">f_s_slope =</span> <span class="fl">0.005</span>,</a>
<a class="sourceLine" id="cb2-57" title="57">                 <span class="dt">mu_fd =</span> <span class="dv">9</span>,</a>
<a class="sourceLine" id="cb2-58" title="58">                 <span class="dt">sd_fd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-59" title="59"></a>
<a class="sourceLine" id="cb2-60" title="60"><span class="co"># Now, simulate some random intercepts for growth, survival, and offspring production</span></a>
<a class="sourceLine" id="cb2-61" title="61">g_r_int &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb2-62" title="62">s_r_int &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb2-63" title="63">f_s_r_int &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb2-64" title="64"></a>
<a class="sourceLine" id="cb2-65" title="65">nms &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"r_"</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">sep =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb2-66" title="66"></a>
<a class="sourceLine" id="cb2-67" title="67"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(g_r_int) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">'g_'</span>, nms, <span class="dt">sep =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb2-68" title="68"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(s_r_int) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">'s_'</span>, nms, <span class="dt">sep =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb2-69" title="69"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(f_s_r_int) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">'f_s_'</span>, nms, <span class="dt">sep =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb2-70" title="70"></a>
<a class="sourceLine" id="cb2-71" title="71"><span class="co"># The !!! operator used inside of list2 from rlang takes the named vector</span></a>
<a class="sourceLine" id="cb2-72" title="72"><span class="co"># and converts it to a named list. This can be spliced into the data list </span></a>
<a class="sourceLine" id="cb2-73" title="73"><span class="co"># to rapidly make a parameter set suitable for usage in the data_list argument</span></a>
<a class="sourceLine" id="cb2-74" title="74"><span class="co"># of define_kernel</span></a>
<a class="sourceLine" id="cb2-75" title="75"></a>
<a class="sourceLine" id="cb2-76" title="76">g_params &lt;-<span class="st"> </span><span class="kw">list2</span>(<span class="op">!!!</span><span class="st"> </span>g_r_int)</a>
<a class="sourceLine" id="cb2-77" title="77">s_params &lt;-<span class="st"> </span><span class="kw">list2</span>(<span class="op">!!!</span><span class="st"> </span>s_r_int)</a>
<a class="sourceLine" id="cb2-78" title="78">f_s_params &lt;-<span class="st"> </span><span class="kw">list2</span>(<span class="op">!!!</span><span class="st"> </span>f_s_r_int)</a>
<a class="sourceLine" id="cb2-79" title="79"></a>
<a class="sourceLine" id="cb2-80" title="80">params &lt;-<span class="st"> </span><span class="kw">splice</span>(data_list, g_params, s_params, f_s_params)</a>
<a class="sourceLine" id="cb2-81" title="81"></a>
<a class="sourceLine" id="cb2-82" title="82"></a>
<a class="sourceLine" id="cb2-83" title="83">b &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.2</span>, <span class="dv">40</span>, <span class="dt">length.out =</span> <span class="dv">101</span>)</a>
<a class="sourceLine" id="cb2-84" title="84">sv1 &lt;-<span class="st"> </span>sv2 &lt;-<span class="st"> </span>(b[<span class="dv">2</span><span class="op">:</span><span class="dv">101</span>] <span class="op">+</span><span class="st"> </span>b[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>]) <span class="op">*</span><span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb2-85" title="85">h &lt;-<span class="st"> </span>sv1[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>sv1[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb2-86" title="86"></a>
<a class="sourceLine" id="cb2-87" title="87"><span class="co"># repetitive to demonstrate the typical kernel construction process.</span></a>
<a class="sourceLine" id="cb2-88" title="88"></a>
<a class="sourceLine" id="cb2-89" title="89">g_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> g, <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>g_int,</a>
<a class="sourceLine" id="cb2-90" title="90">                                               params<span class="op">$</span>g_slope,</a>
<a class="sourceLine" id="cb2-91" title="91">                                               params<span class="op">$</span>sd_g),</a>
<a class="sourceLine" id="cb2-92" title="92">                 <span class="dt">r_effect =</span> params<span class="op">$</span>g_r_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-93" title="93"></a>
<a class="sourceLine" id="cb2-94" title="94">g_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> g, <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>g_int,</a>
<a class="sourceLine" id="cb2-95" title="95">                                               params<span class="op">$</span>g_slope,</a>
<a class="sourceLine" id="cb2-96" title="96">                                               params<span class="op">$</span>sd_g),</a>
<a class="sourceLine" id="cb2-97" title="97">                 <span class="dt">r_effect =</span> params<span class="op">$</span>g_r_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-98" title="98">g_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> g, <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>g_int,</a>
<a class="sourceLine" id="cb2-99" title="99">                                               params<span class="op">$</span>g_slope,</a>
<a class="sourceLine" id="cb2-100" title="100">                                               params<span class="op">$</span>sd_g),</a>
<a class="sourceLine" id="cb2-101" title="101">                 <span class="dt">r_effect =</span> params<span class="op">$</span>g_r_<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-102" title="102"></a>
<a class="sourceLine" id="cb2-103" title="103">g_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> g, <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>g_int,</a>
<a class="sourceLine" id="cb2-104" title="104">                                               params<span class="op">$</span>g_slope,</a>
<a class="sourceLine" id="cb2-105" title="105">                                               params<span class="op">$</span>sd_g),</a>
<a class="sourceLine" id="cb2-106" title="106">                 <span class="dt">r_effect =</span> params<span class="op">$</span>g_r_<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb2-107" title="107"></a>
<a class="sourceLine" id="cb2-108" title="108">g_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> g, <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>g_int,</a>
<a class="sourceLine" id="cb2-109" title="109">                                               params<span class="op">$</span>g_slope,</a>
<a class="sourceLine" id="cb2-110" title="110">                                               params<span class="op">$</span>sd_g),</a>
<a class="sourceLine" id="cb2-111" title="111">                 <span class="dt">r_effect =</span> params<span class="op">$</span>g_r_<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-112" title="112"></a>
<a class="sourceLine" id="cb2-113" title="113">g_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="reference/eviction.html">truncated_distributions</a></span>(g_<span class="dv">1</span>, <span class="dt">n_mesh_p =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2-114" title="114">g_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="reference/eviction.html">truncated_distributions</a></span>(g_<span class="dv">2</span>, <span class="dt">n_mesh_p =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2-115" title="115">g_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="reference/eviction.html">truncated_distributions</a></span>(g_<span class="dv">3</span>, <span class="dt">n_mesh_p =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2-116" title="116">g_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw"><a href="reference/eviction.html">truncated_distributions</a></span>(g_<span class="dv">4</span>, <span class="dt">n_mesh_p =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2-117" title="117">g_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw"><a href="reference/eviction.html">truncated_distributions</a></span>(g_<span class="dv">5</span>, <span class="dt">n_mesh_p =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2-118" title="118"></a>
<a class="sourceLine" id="cb2-119" title="119">s_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">s</span>(sv1, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>s_int, params<span class="op">$</span>s_slope,</a>
<a class="sourceLine" id="cb2-120" title="120">                params<span class="op">$</span>f_r_int, params<span class="op">$</span>f_r_slope), params<span class="op">$</span>s_r_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-121" title="121">s_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">s</span>(sv1, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>s_int, params<span class="op">$</span>s_slope,</a>
<a class="sourceLine" id="cb2-122" title="122">                params<span class="op">$</span>f_r_int, params<span class="op">$</span>f_r_slope), params<span class="op">$</span>s_r_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-123" title="123">s_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">s</span>(sv1, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>s_int, params<span class="op">$</span>s_slope,</a>
<a class="sourceLine" id="cb2-124" title="124">                params<span class="op">$</span>f_r_int, params<span class="op">$</span>f_r_slope), params<span class="op">$</span>s_r_<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-125" title="125">s_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">s</span>(sv1, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>s_int, params<span class="op">$</span>s_slope,</a>
<a class="sourceLine" id="cb2-126" title="126">                params<span class="op">$</span>f_r_int, params<span class="op">$</span>f_r_slope), params<span class="op">$</span>s_r_<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb2-127" title="127">s_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw">s</span>(sv1, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(params<span class="op">$</span>s_int, params<span class="op">$</span>s_slope,</a>
<a class="sourceLine" id="cb2-128" title="128">                params<span class="op">$</span>f_r_int, params<span class="op">$</span>f_r_slope), params<span class="op">$</span>s_r_<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-129" title="129"></a>
<a class="sourceLine" id="cb2-130" title="130">P_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(s_<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(g_<span class="dv">1</span>)) <span class="op">*</span><span class="st"> </span>h</a>
<a class="sourceLine" id="cb2-131" title="131">P_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(s_<span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(g_<span class="dv">2</span>)) <span class="op">*</span><span class="st"> </span>h</a>
<a class="sourceLine" id="cb2-132" title="132">P_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(s_<span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(g_<span class="dv">3</span>)) <span class="op">*</span><span class="st"> </span>h</a>
<a class="sourceLine" id="cb2-133" title="133">P_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(s_<span class="dv">4</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(g_<span class="dv">4</span>)) <span class="op">*</span><span class="st"> </span>h</a>
<a class="sourceLine" id="cb2-134" title="134">P_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(s_<span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(g_<span class="dv">5</span>)) <span class="op">*</span><span class="st"> </span>h</a>
<a class="sourceLine" id="cb2-135" title="135"></a>
<a class="sourceLine" id="cb2-136" title="136"><span class="co"># These are not corrected for eviction, but they probably should be</span></a>
<a class="sourceLine" id="cb2-137" title="137">F_<span class="dv">1</span> &lt;-<span class="st"> </span>h <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> fec,</a>
<a class="sourceLine" id="cb2-138" title="138">                 <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(params[<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>]),</a>
<a class="sourceLine" id="cb2-139" title="139">                 <span class="dt">r_effect =</span> params<span class="op">$</span>f_s_r_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-140" title="140"></a>
<a class="sourceLine" id="cb2-141" title="141">F_<span class="dv">2</span> &lt;-<span class="st"> </span>h <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> fec,</a>
<a class="sourceLine" id="cb2-142" title="142">                 <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(params[<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>]),</a>
<a class="sourceLine" id="cb2-143" title="143">                 <span class="dt">r_effect =</span> params<span class="op">$</span>f_s_r_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-144" title="144"></a>
<a class="sourceLine" id="cb2-145" title="145">F_<span class="dv">3</span> &lt;-<span class="st"> </span>h <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> fec,</a>
<a class="sourceLine" id="cb2-146" title="146">                 <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(params[<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>]),</a>
<a class="sourceLine" id="cb2-147" title="147">                 <span class="dt">r_effect =</span> params<span class="op">$</span>f_s_r_<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-148" title="148"></a>
<a class="sourceLine" id="cb2-149" title="149">F_<span class="dv">4</span> &lt;-<span class="st"> </span>h <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> fec,</a>
<a class="sourceLine" id="cb2-150" title="150">                 <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(params[<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>]),</a>
<a class="sourceLine" id="cb2-151" title="151">                 <span class="dt">r_effect =</span> params<span class="op">$</span>f_s_r_<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb2-152" title="152"></a>
<a class="sourceLine" id="cb2-153" title="153">F_<span class="dv">5</span> &lt;-<span class="st"> </span>h <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/outer">outer</a></span>(sv1, sv2, <span class="dt">FUN =</span> fec,</a>
<a class="sourceLine" id="cb2-154" title="154">                 <span class="dt">params =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(params[<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>]),</a>
<a class="sourceLine" id="cb2-155" title="155">                 <span class="dt">r_effect =</span> params<span class="op">$</span>f_s_r_<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-156" title="156"></a>
<a class="sourceLine" id="cb2-157" title="157"></a>
<a class="sourceLine" id="cb2-158" title="158">K_<span class="dv">1</span> &lt;-<span class="st"> </span>P_<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>F_<span class="dv">1</span></a>
<a class="sourceLine" id="cb2-159" title="159">K_<span class="dv">2</span> &lt;-<span class="st"> </span>P_<span class="dv">2</span> <span class="op">+</span><span class="st"> </span>F_<span class="dv">2</span></a>
<a class="sourceLine" id="cb2-160" title="160">K_<span class="dv">3</span> &lt;-<span class="st"> </span>P_<span class="dv">3</span> <span class="op">+</span><span class="st"> </span>F_<span class="dv">3</span></a>
<a class="sourceLine" id="cb2-161" title="161">K_<span class="dv">4</span> &lt;-<span class="st"> </span>P_<span class="dv">4</span> <span class="op">+</span><span class="st"> </span>F_<span class="dv">4</span></a>
<a class="sourceLine" id="cb2-162" title="162">K_<span class="dv">5</span> &lt;-<span class="st"> </span>P_<span class="dv">5</span> <span class="op">+</span><span class="st"> </span>F_<span class="dv">5</span></a>
<a class="sourceLine" id="cb2-163" title="163"></a>
<a class="sourceLine" id="cb2-164" title="164">lambdas &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(K_<span class="dv">1</span>)<span class="op">$</span>values[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb2-165" title="165">             <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(K_<span class="dv">2</span>)<span class="op">$</span>values[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb2-166" title="166">             <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(K_<span class="dv">3</span>)<span class="op">$</span>values[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb2-167" title="167">             <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(K_<span class="dv">4</span>)<span class="op">$</span>values[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb2-168" title="168">             <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(K_<span class="dv">5</span>)<span class="op">$</span>values[<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb2-169" title="169"></a>
<a class="sourceLine" id="cb2-170" title="170"></a>
<a class="sourceLine" id="cb2-171" title="171"><span class="co">## ipmr version</span></a>
<a class="sourceLine" id="cb2-172" title="172"></a>
<a class="sourceLine" id="cb2-173" title="173"><span class="co"># define the levels of the hierarchical variable and save them in a named</span></a>
<a class="sourceLine" id="cb2-174" title="174"><span class="co"># list that corresponds to the suffix in the kernel notation</span></a>
<a class="sourceLine" id="cb2-175" title="175">hier_levels &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">yr =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-176" title="176"></a>
<a class="sourceLine" id="cb2-177" title="177"><span class="co"># additional usr_funs to be passed into make_ipm()</span></a>
<a class="sourceLine" id="cb2-178" title="178">inv_logit &lt;-<span class="st"> </span><span class="cf">function</span>(sv, int, slope) {</a>
<a class="sourceLine" id="cb2-179" title="179">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(</a>
<a class="sourceLine" id="cb2-180" title="180">    <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>(int <span class="op">+</span><span class="st"> </span>slope <span class="op">*</span><span class="st"> </span>sv)))</a>
<a class="sourceLine" id="cb2-181" title="181">  )</a>
<a class="sourceLine" id="cb2-182" title="182">}</a>
<a class="sourceLine" id="cb2-183" title="183"></a>
<a class="sourceLine" id="cb2-184" title="184">inv_logit_r &lt;-<span class="st"> </span><span class="cf">function</span>(sv, int, slope, r_eff) {</a>
<a class="sourceLine" id="cb2-185" title="185">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(</a>
<a class="sourceLine" id="cb2-186" title="186">    <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>(int <span class="op">+</span><span class="st"> </span>slope <span class="op">*</span><span class="st"> </span>sv <span class="op">+</span><span class="st"> </span>r_eff)))</a>
<a class="sourceLine" id="cb2-187" title="187">  )</a>
<a class="sourceLine" id="cb2-188" title="188">}</a>
<a class="sourceLine" id="cb2-189" title="189"></a>
<a class="sourceLine" id="cb2-190" title="190">pois_r &lt;-<span class="st"> </span><span class="cf">function</span>(sv, int, slope, r_eff) {</a>
<a class="sourceLine" id="cb2-191" title="191">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(</a>
<a class="sourceLine" id="cb2-192" title="192">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(</a>
<a class="sourceLine" id="cb2-193" title="193">      int <span class="op">+</span><span class="st"> </span>slope <span class="op">*</span><span class="st"> </span>sv <span class="op">+</span><span class="st"> </span>r_eff</a>
<a class="sourceLine" id="cb2-194" title="194">    )</a>
<a class="sourceLine" id="cb2-195" title="195">  )</a>
<a class="sourceLine" id="cb2-196" title="196">}</a>
<a class="sourceLine" id="cb2-197" title="197"></a>
<a class="sourceLine" id="cb2-198" title="198"><span class="co"># The "model_class" argument is now changed to reflect a different model type</span></a>
<a class="sourceLine" id="cb2-199" title="199">monocarp_sys &lt;-<span class="st"> </span><span class="kw"><a href="reference/init_ipm.html">init_ipm</a></span>(<span class="st">'simple_di_stoch_kern'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-200" title="200"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb2-201" title="201">    <span class="co"># The yr suffix is appended to the kernel name and the parameter names</span></a>
<a class="sourceLine" id="cb2-202" title="202">    <span class="co"># within each vital rate expression. ipmr substitutes in the hier_levels</span></a>
<a class="sourceLine" id="cb2-203" title="203">    <span class="co"># for each suffix occurrence, thus changing P_yr in P_1, P_2, P_3, P_4, P_5,</span></a>
<a class="sourceLine" id="cb2-204" title="204">    <span class="co"># s_yr in s_1, s_2, s_3, s_4, and s_5. s_r_yr is converted to s_r_1, s_r_2, </span></a>
<a class="sourceLine" id="cb2-205" title="205">    <span class="co"># etc. In the case of s_r_yr, provided that the names in the data_list match</span></a>
<a class="sourceLine" id="cb2-206" title="206">    <span class="co"># the expanded names, all will go well!</span></a>
<a class="sourceLine" id="cb2-207" title="207">    </a>
<a class="sourceLine" id="cb2-208" title="208">    <span class="dt">name =</span> <span class="st">'P_yr'</span>,</a>
<a class="sourceLine" id="cb2-209" title="209">    <span class="dt">formula =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(s_yr <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(g_yr)) ,</a>
<a class="sourceLine" id="cb2-210" title="210">    <span class="dt">family =</span> <span class="st">"CC"</span>,</a>
<a class="sourceLine" id="cb2-211" title="211">    <span class="dt">s_yr =</span> <span class="kw">inv_logit_r</span>(ht_<span class="dv">1</span>, s_int, s_slope, s_r_yr) <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-212" title="212"><span class="st">      </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">inv_logit</span>(ht_<span class="dv">1</span>, f_r_int, f_r_slope)),</a>
<a class="sourceLine" id="cb2-213" title="213">    <span class="dt">g_yr =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(ht_<span class="dv">2</span>, <span class="dt">mean =</span> mu_g_yr, <span class="dt">sd =</span> sd_g),</a>
<a class="sourceLine" id="cb2-214" title="214">    <span class="dt">mu_g_yr =</span> g_int <span class="op">+</span><span class="st"> </span>g_slope <span class="op">*</span><span class="st"> </span>ht_<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>g_r_yr,</a>
<a class="sourceLine" id="cb2-215" title="215">    <span class="dt">data_list =</span> params,</a>
<a class="sourceLine" id="cb2-216" title="216">    <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'ht'</span>)),</a>
<a class="sourceLine" id="cb2-217" title="217">    <span class="dt">has_hier_effs =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb2-218" title="218">    <span class="dt">levels_hier_effs =</span> hier_levels,</a>
<a class="sourceLine" id="cb2-219" title="219">    <span class="dt">evict =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb2-220" title="220">    <span class="co"># Note that the suffix is appended here since the growth kernel also has a random intercept.</span></a>
<a class="sourceLine" id="cb2-221" title="221">    <span class="dt">evict_fun =</span> <span class="kw"><a href="reference/eviction.html">truncated_distributions</a></span>(g_yr,</a>
<a class="sourceLine" id="cb2-222" title="222">                                        <span class="dt">n_mesh_p =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2-223" title="223">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-224" title="224"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb2-225" title="225">    <span class="st">"F_yr"</span>,</a>
<a class="sourceLine" id="cb2-226" title="226">    <span class="dt">formula =</span> f_r <span class="op">*</span><span class="st"> </span>f_s_yr <span class="op">*</span><span class="st"> </span>f_d,</a>
<a class="sourceLine" id="cb2-227" title="227">    <span class="dt">family =</span> <span class="st">"CC"</span>,</a>
<a class="sourceLine" id="cb2-228" title="228">    <span class="dt">f_r =</span> <span class="kw">inv_logit</span>(ht_<span class="dv">1</span>, f_r_int, f_r_slope),</a>
<a class="sourceLine" id="cb2-229" title="229">    <span class="dt">f_s_yr =</span> <span class="kw">pois_r</span>(ht_<span class="dv">1</span>, f_s_int, f_s_slope, f_s_r_yr),</a>
<a class="sourceLine" id="cb2-230" title="230">    <span class="dt">f_d =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(ht_<span class="dv">2</span>, <span class="dt">mean =</span> mu_fd, <span class="dt">sd =</span> sd_fd),</a>
<a class="sourceLine" id="cb2-231" title="231">    <span class="dt">data_list =</span> params,</a>
<a class="sourceLine" id="cb2-232" title="232">    <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'ht'</span>)),</a>
<a class="sourceLine" id="cb2-233" title="233">    <span class="dt">has_hier_effs =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb2-234" title="234">    <span class="dt">levels_hier_effs =</span> hier_levels,</a>
<a class="sourceLine" id="cb2-235" title="235">    <span class="dt">evict =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-236" title="236"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_k</a></span>(</a>
<a class="sourceLine" id="cb2-237" title="237">    <span class="st">'K_yr'</span>,</a>
<a class="sourceLine" id="cb2-238" title="238">    <span class="dt">K_yr =</span> P_yr <span class="op">+</span><span class="st"> </span>F_yr,</a>
<a class="sourceLine" id="cb2-239" title="239">    <span class="dt">family =</span> <span class="st">"IPM"</span>,</a>
<a class="sourceLine" id="cb2-240" title="240">    <span class="dt">data_list =</span> params,</a>
<a class="sourceLine" id="cb2-241" title="241">    <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ht"</span>)),</a>
<a class="sourceLine" id="cb2-242" title="242">    <span class="dt">has_hier_effs =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb2-243" title="243">    <span class="dt">levels_hier_effs =</span> hier_levels,</a>
<a class="sourceLine" id="cb2-244" title="244">    <span class="dt">evict =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb2-245" title="245">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-246" title="246"><span class="st">  </span><span class="kw"><a href="reference/impl-args.html">define_impl</a></span>(</a>
<a class="sourceLine" id="cb2-247" title="247">    <span class="kw"><a href="reference/impl-args.html">make_impl_args_list</a></span>(</a>
<a class="sourceLine" id="cb2-248" title="248">      <span class="dt">kernel_names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"K_yr"</span>, <span class="st">"P_yr"</span>, <span class="st">"F_yr"</span>),</a>
<a class="sourceLine" id="cb2-249" title="249">      <span class="dt">int_rule =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"midpoint"</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb2-250" title="250">      <span class="dt">dom_start =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"ht"</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb2-251" title="251">      <span class="dt">dom_end =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">"ht"</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-252" title="252">    )</a>
<a class="sourceLine" id="cb2-253" title="253">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-254" title="254"><span class="st">  </span><span class="kw"><a href="reference/doms-n-states.html">define_domains</a></span>(<span class="dt">ht =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.2</span>, <span class="dv">40</span>, <span class="dv">100</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-255" title="255"><span class="st">  </span><span class="kw"><a href="reference/make_ipm.html">make_ipm</a></span>(<span class="dt">usr_funs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">inv_logit =</span> inv_logit,</a>
<a class="sourceLine" id="cb2-256" title="256">                           <span class="dt">inv_logit_r =</span> inv_logit_r,</a>
<a class="sourceLine" id="cb2-257" title="257">                           <span class="dt">pois_r =</span> pois_r))</a>
<a class="sourceLine" id="cb2-258" title="258"></a>
<a class="sourceLine" id="cb2-259" title="259"></a>
<a class="sourceLine" id="cb2-260" title="260">ks          &lt;-<span class="st"> </span>monocarp_sys<span class="op">$</span>iterators</a>
<a class="sourceLine" id="cb2-261" title="261">lambda_ipmr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">vapply</a></span>(ks, <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/complex">Re</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(x)<span class="op">$</span>values[<span class="dv">1</span>]), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">numeric</a></span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb2-262" title="262"></a>
<a class="sourceLine" id="cb2-263" title="263">lambda_ipmr <span class="op">-</span><span class="st"> </span>lambdas</a></code></pre></div>
</div>
<div id="simple-density-independet-parameter-resampled-models" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-density-independet-parameter-resampled-models" class="anchor"></a>Simple, density independet, parameter resampled models</h2>
<p>These models are stochastic, but rather than building the iteration kernels first and then iterating them - distributions for varying parameters are specified ahead of time and then resampled at each iteration. <code>ipmr</code> is careful to only evaluate each expression once per iteration, allowing you to specify parameters sampled from a joint distribution with a single expression. Their notation <em>usually</em> does not require suffix notation, though this example uses it to make clear which parameters are varying and which are fixed. All that’s required is that:</p>
<ol style="list-style-type: decimal">
<li><p>the function returns a named list of parameter values and</p></li>
<li><p>the names of the list values and the names used in the vital rate/kernel expressions match.</p></li>
</ol>
<p>The user-specified function should go into <code><a href="reference/define_star.html">define_env_state()</a></code> call. The values can then be referenced using <code>list_name$parameter_name</code> notation in the vital rate expressions.</p>
<p>This example uses the <code>rmvnorm</code> function from the <code>mvtnorm</code> package to demonstrate how one might sample from a joint distribution of parameters. One could also pass a function that samples from a posterior distribution of a Bayesian model, and pass the associated posterior to the <code>data_list</code> argument in <code>define_env_state</code> to propagate parameter uncertainty throughout the model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ipmr)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(mvtnorm)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># Define the fixed parameters in a list</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6">data_list &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">s_slope =</span> <span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">                  <span class="dt">g_slope =</span> <span class="fl">0.99</span>,</a>
<a class="sourceLine" id="cb3-8" title="8">                  <span class="dt">g_sd =</span> <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb3-9" title="9">                  <span class="dt">f_r_slope =</span> <span class="fl">0.03</span>,</a>
<a class="sourceLine" id="cb3-10" title="10">                  <span class="dt">f_s_slope =</span> <span class="fl">0.001</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">                  <span class="dt">f_d_mu =</span> <span class="fl">1.1</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">                  <span class="dt">f_d_sd =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co"># Simulate some random parameters to define the multivariate distribution</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co"># to sample from. In user-specified models, these will likely come from mixed</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="co"># effects models fit to real data.</span></a>
<a class="sourceLine" id="cb3-17" title="17">r_means &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">s_int_yr =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb3-18" title="18">             <span class="dt">g_int_yr =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb3-19" title="19">             <span class="dt">f_r_int_yr =</span> <span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb3-20" title="20">             <span class="dt">f_s_int_yr =</span> <span class="fl">0.4</span>)</a>
<a class="sourceLine" id="cb3-21" title="21"></a>
<a class="sourceLine" id="cb3-22" title="22">r_sigma &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">16</span>)</a>
<a class="sourceLine" id="cb3-23" title="23">r_sigma &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(r_sigma, <span class="dt">nrow =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25">r_sigma &lt;-<span class="st"> </span>r_sigma <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(r_sigma) <span class="co"># make symmetrical - most users should skip this step.</span></a>
<a class="sourceLine" id="cb3-26" title="26"></a>
<a class="sourceLine" id="cb3-27" title="27">iterations &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb3-28" title="28"></a>
<a class="sourceLine" id="cb3-29" title="29"><span class="co"># Specify an initial population vector. This can also be done in the call to</span></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="co"># define_pop_state</span></a>
<a class="sourceLine" id="cb3-31" title="31"></a>
<a class="sourceLine" id="cb3-32" title="32">init_pop_vec &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb3-33" title="33"></a>
<a class="sourceLine" id="cb3-34" title="34"><span class="co"># Again, we can define our own functions and pass them into calls to make_ipm</span></a>
<a class="sourceLine" id="cb3-35" title="35">inv_logit &lt;-<span class="st"> </span><span class="cf">function</span>(int, slope, sv1) {</a>
<a class="sourceLine" id="cb3-36" title="36">  <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>(int <span class="op">+</span><span class="st"> </span>slope <span class="op">*</span><span class="st"> </span>sv1)))</a>
<a class="sourceLine" id="cb3-37" title="37">}</a>
<a class="sourceLine" id="cb3-38" title="38"></a>
<a class="sourceLine" id="cb3-39" title="39"><span class="co"># In this case, we define a wrapper function around rmvnorm to make sure</span></a>
<a class="sourceLine" id="cb3-40" title="40"><span class="co"># that the names of the returned values match those in the vital rate</span></a>
<a class="sourceLine" id="cb3-41" title="41"><span class="co"># expressions.</span></a>
<a class="sourceLine" id="cb3-42" title="42"></a>
<a class="sourceLine" id="cb3-43" title="43">mvt_wrapper &lt;-<span class="st"> </span><span class="cf">function</span>(r_means, r_sigma, nms) {</a>
<a class="sourceLine" id="cb3-44" title="44">  out &lt;-<span class="st"> </span>mvtnorm<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/mvtnorm/topics/Mvnorm">rmvnorm</a></span>(<span class="dv">1</span>, r_means, r_sigma) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-45" title="45"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">as.list</a></span>()</a>
<a class="sourceLine" id="cb3-46" title="46">  </a>
<a class="sourceLine" id="cb3-47" title="47">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(out) &lt;-<span class="st"> </span>nms</a>
<a class="sourceLine" id="cb3-48" title="48">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(out)</a>
<a class="sourceLine" id="cb3-49" title="49">}</a>
<a class="sourceLine" id="cb3-50" title="50"></a>
<a class="sourceLine" id="cb3-51" title="51">param_resamp_model &lt;-<span class="st"> </span><span class="kw"><a href="reference/init_ipm.html">init_ipm</a></span>(<span class="st">'simple_di_stoch_param'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-52" title="52"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb3-53" title="53">    <span class="st">'P'</span>,</a>
<a class="sourceLine" id="cb3-54" title="54">    <span class="dt">formula =</span> <span class="kw"><a href="reference/fun-mult-helpers.html">s_g_mult</a></span>(s, g),</a>
<a class="sourceLine" id="cb3-55" title="55">    <span class="dt">family =</span> <span class="st">'CC'</span>,</a>
<a class="sourceLine" id="cb3-56" title="56">    <span class="co"># Note here that the growth and survival intercepts are prefaced with env_params$...</span></a>
<a class="sourceLine" id="cb3-57" title="57">    <span class="co"># This is because the mvt_wrapper function is named env_params in the call</span></a>
<a class="sourceLine" id="cb3-58" title="58">    <span class="co"># to define_env_state(). env_params is not a reserved word, so you can call</span></a>
<a class="sourceLine" id="cb3-59" title="59">    <span class="co"># it whatever you like.</span></a>
<a class="sourceLine" id="cb3-60" title="60">    <span class="dt">g_mu =</span> env_params<span class="op">$</span>g_int_yr <span class="op">+</span><span class="st"> </span>g_slope <span class="op">*</span><span class="st"> </span>surf_area_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-61" title="61">    <span class="dt">s =</span> <span class="kw">inv_logit</span>(env_params<span class="op">$</span>s_int_yr, s_slope, surf_area_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-62" title="62">    <span class="dt">g =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(surf_area_<span class="dv">2</span>, g_mu, g_sd),</a>
<a class="sourceLine" id="cb3-63" title="63">    <span class="dt">data_list =</span> data_list,</a>
<a class="sourceLine" id="cb3-64" title="64">    <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'surf_area'</span>)),</a>
<a class="sourceLine" id="cb3-65" title="65">    <span class="dt">has_hier_effs =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb3-66" title="66">    <span class="dt">evict =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-67" title="67">    <span class="dt">evict_fun =</span> <span class="kw"><a href="reference/eviction.html">truncated_distributions</a></span>(g,</a>
<a class="sourceLine" id="cb3-68" title="68">                                        <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb3-69" title="69">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-70" title="70"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_kernel</a></span>(</a>
<a class="sourceLine" id="cb3-71" title="71">    <span class="st">'F'</span>,</a>
<a class="sourceLine" id="cb3-72" title="72">    <span class="dt">formula =</span> f_r <span class="op">*</span><span class="st"> </span>f_s <span class="op">*</span><span class="st"> </span>f_d,</a>
<a class="sourceLine" id="cb3-73" title="73">    <span class="dt">family =</span> <span class="st">'CC'</span>,</a>
<a class="sourceLine" id="cb3-74" title="74">    <span class="dt">f_r =</span> <span class="kw">inv_logit</span>(env_params<span class="op">$</span>f_r_int_yr, f_r_slope, surf_area_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-75" title="75">    <span class="dt">f_s =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(env_params<span class="op">$</span>f_s_int_yr <span class="op">+</span><span class="st"> </span>f_s_slope <span class="op">*</span><span class="st"> </span>surf_area_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-76" title="76">    <span class="dt">f_d =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(surf_area_<span class="dv">2</span>, f_d_mu, f_d_sd),</a>
<a class="sourceLine" id="cb3-77" title="77">    <span class="dt">data_list =</span> data_list,</a>
<a class="sourceLine" id="cb3-78" title="78">    <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'surf_area'</span>)),</a>
<a class="sourceLine" id="cb3-79" title="79">    <span class="dt">has_hier_effs =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb3-80" title="80">    <span class="dt">evict =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb3-81" title="81">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-82" title="82"><span class="st">  </span><span class="kw"><a href="reference/kernel-definitions.html">define_k</a></span>(</a>
<a class="sourceLine" id="cb3-83" title="83">    <span class="st">'K'</span>,</a>
<a class="sourceLine" id="cb3-84" title="84">    </a>
<a class="sourceLine" id="cb3-85" title="85">    <span class="co"># Note that here, we specify both the form of the iteration kernel and</span></a>
<a class="sourceLine" id="cb3-86" title="86">    <span class="co"># the iteration procedure. right_mult() is a helper function to make sure</span></a>
<a class="sourceLine" id="cb3-87" title="87">    <span class="co"># population states are multiplied by the kernels correctly.</span></a>
<a class="sourceLine" id="cb3-88" title="88">    <span class="dt">K =</span> P <span class="op">+</span><span class="st"> </span>F,</a>
<a class="sourceLine" id="cb3-89" title="89">    <span class="dt">n_surf_area_t_1 =</span> <span class="kw"><a href="reference/fun-mult-helpers.html">right_mult</a></span>(K, n_surf_area_t),</a>
<a class="sourceLine" id="cb3-90" title="90">    <span class="dt">family =</span> <span class="st">'IPM'</span>,</a>
<a class="sourceLine" id="cb3-91" title="91">    <span class="dt">data_list =</span> data_list,</a>
<a class="sourceLine" id="cb3-92" title="92">    <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'surf_area'</span>)),</a>
<a class="sourceLine" id="cb3-93" title="93">    <span class="dt">has_hier_effs =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb3-94" title="94">    <span class="dt">evict =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb3-95" title="95">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-96" title="96"><span class="st">  </span><span class="kw"><a href="reference/impl-args.html">define_impl</a></span>(</a>
<a class="sourceLine" id="cb3-97" title="97">    <span class="kw"><a href="reference/impl-args.html">make_impl_args_list</a></span>(</a>
<a class="sourceLine" id="cb3-98" title="98">      <span class="dt">kernel_names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'P'</span>, <span class="st">"F"</span>, <span class="st">"K"</span>),</a>
<a class="sourceLine" id="cb3-99" title="99">      <span class="dt">int_rule =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">'midpoint'</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb3-100" title="100">      <span class="dt">dom_start =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">'surf_area'</span>,<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb3-101" title="101">      <span class="dt">dom_end =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="st">'surf_area'</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb3-102" title="102">    )</a>
<a class="sourceLine" id="cb3-103" title="103">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-104" title="104"><span class="st">  </span><span class="kw"><a href="reference/doms-n-states.html">define_domains</a></span>(<span class="dt">surf_area =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-105" title="105"><span class="st">  </span><span class="kw"><a href="reference/define_star.html">define_env_state</a></span>(</a>
<a class="sourceLine" id="cb3-106" title="106">    <span class="dt">env_params =</span> <span class="kw">mvt_wrapper</span>(r_means, r_sigma, <span class="dt">nms =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'s_int_yr'</span>,</a>
<a class="sourceLine" id="cb3-107" title="107">                                                       <span class="st">'g_int_yr'</span>,</a>
<a class="sourceLine" id="cb3-108" title="108">                                                       <span class="st">'f_r_int_yr'</span>,</a>
<a class="sourceLine" id="cb3-109" title="109">                                                       <span class="st">'f_s_int_yr'</span>)),</a>
<a class="sourceLine" id="cb3-110" title="110">    <span class="dt">data_list =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb3-111" title="111">      <span class="dt">r_means =</span> r_means,</a>
<a class="sourceLine" id="cb3-112" title="112">      <span class="dt">r_sigma =</span> r_sigma</a>
<a class="sourceLine" id="cb3-113" title="113">    )</a>
<a class="sourceLine" id="cb3-114" title="114">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-115" title="115"><span class="st">  </span><span class="kw"><a href="reference/define_star.html">define_pop_state</a></span>(</a>
<a class="sourceLine" id="cb3-116" title="116">    <span class="dt">pop_vectors =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">n_surf_area_t =</span> init_pop_vec),</a>
<a class="sourceLine" id="cb3-117" title="117">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-118" title="118"><span class="st">  </span><span class="kw"><a href="reference/make_ipm.html">make_ipm</a></span>(<span class="dt">usr_funs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">inv_logit =</span> inv_logit,</a>
<a class="sourceLine" id="cb3-119" title="119">                           <span class="dt">mvt_wrapper =</span> mvt_wrapper),</a>
<a class="sourceLine" id="cb3-120" title="120">           <span class="dt">iterate =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-121" title="121">           <span class="dt">iterations =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb3-122" title="122"></a>
<a class="sourceLine" id="cb3-123" title="123">pop_state_ipmr &lt;-<span class="st"> </span>param_resamp_model<span class="op">$</span>pop_state<span class="op">$</span>pop_state_surf_area</a>
<a class="sourceLine" id="cb3-124" title="124">lambda_ipmr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">numeric</a></span>(iterations)</a>
<a class="sourceLine" id="cb3-125" title="125"></a>
<a class="sourceLine" id="cb3-126" title="126"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(pop_state_ipmr)[<span class="dv">2</span>], <span class="dv">1</span>)) {</a>
<a class="sourceLine" id="cb3-127" title="127">  lambda_ipmr[(i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(pop_state_ipmr[ ,i]) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(pop_state_ipmr[ ,(i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)])</a>
<a class="sourceLine" id="cb3-128" title="128">}</a>
<a class="sourceLine" id="cb3-129" title="129"></a>
<a class="sourceLine" id="cb3-130" title="130">lambda_ipmr</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Sam Levin <br><small class="roles"> Author, maintainer </small>  </li>
<li>First Last <br><small class="roles"> Author </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/levisc8/ipmr"><img src="https://travis-ci.org/levisc8/ipmr.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/gh/levisc8/ipmr?branch=master"><img src="https://codecov.io/gh/levisc8/ipmr/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sam Levin, First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
